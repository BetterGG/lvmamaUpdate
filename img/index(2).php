(function($,d){var ui={site:('https:'==document.location.protocol?'https://pics.lvjs.com.cn':'http://pic.lvmama.com')+"/js/ui/lvmamaUI/",js:function(temp1,url,callback){var var_key=url.substring(url.lastIndexOf("/")+1);var_key=var_key.indexOf("?")>0?var_key.substring(0,var_key.indexOf("?")):var_key;var_key=var_key.replace(/[^a-z0-9]/gi,"");if(temp1==false){typeof callback=='function'&&callback();return;}
if(!this.temp[var_key]){this.temp[var_key]=this.temp[var_key]||[];}
this.temp[var_key].push(callback);if(document.getElementById(var_key)==null){var elt=d.createElement("script");elt.id=var_key;elt.anysc=true;elt.src=url;if(!d.all){elt.onload=function(){var tmp=ui.temp[var_key];for(var i=0;i<tmp.length;i++){typeof tmp[i]=='function'&&tmp[i]();}}}else{elt.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){var tmp=ui.temp[var_key];for(var i=0;i<tmp.length;i++){typeof tmp[i]=='function'&&tmp[i]();}}}}
d.getElementsByTagName("head")[0].appendChild(elt);}},jsArr:function(arr,call){var loop=function(arr,i,call){if(i>=arr.length){typeof call=='function'&&call();return;}
var elt=document.createElement("script");elt.anysc=true;elt.src=arr[i];elt.charset="utf-8";if(elt.all){elt.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){i++;loop(arr,i,call);}}}else{elt.onload=function(){i++;loop(arr,i,call);}}
d.getElementsByTagName("head")[0].appendChild(elt);}
loop(arr,0,call);},css:function(temp1,url,callback){if(temp1==false){typeof callback=='function'&&callback();return;}
var id=(url.indexOf("?")==-1?url.substring(url.lastIndexOf("/")+1):url.substring(url.lastIndexOf("/")+1,url.indexOf("?"))).replace(".css","");if(document.getElementById(id)){return;}
var elt=d.createElement("link");elt.id=id;elt.rel="stylesheet";elt.anysc=true;elt.href=url;if(!d.all){elt.onload=function(){typeof callback=='function'&&callback();}}else{elt.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){typeof callback=='function'&&callback();}}}
d.getElementsByTagName("head")[0].appendChild(elt);},ie:function(){if($.browser.msie){return parseInt($.browser.version);}else{return 9999;}},getJSON:function(key,url,callback){this.js(!$[key],url,function(){typeof callback=='function'&&callback();})},cache:{},extend:{},temp:{},get:{tab:function(opt){var _this=this;ui.js(!ui.extend.tab,ui.site+"plugin/jquery.tab.js",function(){ui.extend.tab.call(_this,opt);});},lazyload:function(opt){var _this=this;ui.js(!ui.extend.lazyload,ui.site+"plugin/jquery.lazyload.js",function(){ui.extend.lazyload.call(_this,opt);});},popDiv:function(opt){var thisObj=$(this);var selector=opt.to;ui.js(!thisObj.openDialog,ui.site+"plugin/jquery.dialog.js",function(){if(selector){delete opt.to;$(selector).click(function(){thisObj.openDialog(opt);});}else{thisObj.openDialog(opt);}});},countdown:function(opt){var _this=this;ui.js(!ui.extend.countdown,ui.site+"plugin/jquery.countdown.js",function(){ui.extend.countdown.call(_this,opt);});},autoCompleteV2:function(opt){var _this=this;ui.js(!ui.extend.autoComplete,ui.site+"plugin/jquery.autocompleteV2.js",function(){ui.extend.autoComplete.call(_this,opt);});},autoCompleteV2FX:function(opt){var _this=this;ui.js(!ui.extend.autoComplete,ui.site+"plugin/jquery.autocompleteV2FX.js",function(){ui.extend.autoComplete.call(_this,opt);});},autoComplete:function(opt){var txt=$(this);ui.js(!txt.hotelAutocomplete,ui.site+"plugin/jquery.autocomplete.js",function(){txt.hotelAutocomplete(opt);});},adAutoComplete:function(opt){var _this=this;UI.css(true,"http://pic.lvmama.com/js/ui/lvmamaUI/css/jquery.adAuto.css");ui.js(!ui.extend.adAutoComplete,ui.site+"plugin/jquery.adAutocomplete.js",function(){ui.extend.adAutoComplete.call(_this,opt);});},slideMenu:function(opt){var _this=this;ui.js(!ui.extend.slideMenu,ui.site+"plugin/jquery.slideMenu.js",function(){ui.extend.slideMenu.call(_this,opt);});},roller:function(opt){var _this=this;ui.js(!ui.extend.roller,ui.site+"plugin/jquery.roller.js",function(){ui.extend.roller.call(_this,opt);});},scrollImg:function(opt){var _this=this;ui.js(!ui.extend.scrollImg,ui.site+"plugin/jquery.scrollImg.js",function(){ui.extend.scrollImg.call(_this,opt);});},selectArea:function(opt){var _this=this;ui.js(!ui.extend.city,ui.site+"plugin/jquery.city.js",function(){ui.extend.city.call(_this,opt);});},lvtip:function(opt){UI.css(true,"http://pic.lvmama.com/styles/new_v/ob_common/ui-components.css");var _this=this;ui.js(!ui.extend.lvtip,ui.site+"plugin/jquery.lvtip.js",function(){ui.extend.lvtip.call(_this,opt);});},page:function(opt){var _this=this;ui.js(!ui.extend.page,ui.site+"plugin/jquery.page.js",function(){ui.extend.page.call(_this,opt);});},validate:function(opt){var _this=this;ui.js(!ui.extend.validate,ui.site+"plugin/jquery.validate.js",function(){ui.extend.validate.call(_this,opt);});},preview:function(opt){var _this=this;ui.js(!ui.extend.preview,ui.site+"plugin/jquery.preview.js",function(){ui.extend.preview.call(_this,opt);});},calendar:function(opt){ui.js(!window.WdatePicker,ui.site+"plugin/My97Date/WdatePicker.js",function(){if(opt){$(opt.input).each(function(){var This=$(this);This.live('click',function(){WdatePicker(opt.parm)})
var WdatePickerBlur=true;This.blur(function(){if(WdatePickerBlur){setTimeout(function(){This.blur();},100);WdatePickerBlur=false;}});});}});},floatDiv:function(opt){var _this=this;ui.js(!ui.extend.floatDiv,ui.site+"plugin/jquery.floatDiv.js",function(){ui.extend.floatDiv.call(_this,opt);});},recommend:function(opt){var _this=this;ui.js(!ui.extend.recommend,ui.site+"plugin/jquery.recommend.js",function(){ui.extend.recommend.call(_this,opt);});},focusImg:function(opt){var _this=this;ui.js(!ui.extend.focusImg,ui.site+"plugin/jquery.focusImg.js",function(){ui.extend.focusImg.call(_this,opt);});},login:function(opt){UI.css(true,"http://pic.lvmama.com/styles/new_v/ob_login/l_login.css");if(this==UI){UI.js(!window.openLogin,"http://pic.lvmama.com/js/new_v/ob_login/l_fc_login.js",function(){openLogin(2);});}else{UI.js(!window.openLogin,"http://pic.lvmama.com/js/new_v/ob_login/l_fc_login.js");$(this).click(function(){openLogin(2);});}},register:function(opt){var elt=this;UI.css(true,"http://pic.lvmama.com/styles/new_v/ob_login/l_login.css");UI.js(!window.defaultCaptitalId,"http://pic.lvmama.com/js/new_v/ob_login/l_fc_code.js",function(){if(elt==UI){UI.js(!window.openLogin,"http://pic.lvmama.com/js/new_v/ob_login/l_fc_login.js",function(){openLogin(3);});}else{UI.js(!window.openLogin,"http://pic.lvmama.com/js/new_v/ob_login/l_fc_login.js");$(elt).click(function(){openLogin(3);});}});}},firstLoad:function(){$("head").append("<link rel='stylesheet' href='"+ui.site+"css/jquery.common.css'/>");}}
$.fn.ui=function(type,opt){if(typeof ui.get[type]=='function'){opt=opt||{};this.each(function(){ui.get[type].call(this,opt);});}
return this;},$.validate=function(obj,var_hz,callback){var_hz=var_hz||"";var d=document;var len=0;for(var n in obj){if(d.getElementById(n+var_hz)){len++;}}
var i=0,j=0;for(var n in obj){var elt=d.getElementById(n+var_hz);if(elt){i++;var bl=common_validate.call(elt,obj[n],function(){j++;if(j==i&&j==len){callback&&callback();}});if(!bl){return false;}}}
return true;}
window.UI=ui;$(function(){ui.firstLoad();});})(jQuery,document);
;(function($){$.fn.poptip=function(options){var defaults={templete:1,skin:"default",tiptitle:"",place:7,offsetX:0,offsetY:0,trigger:"mouseenter",bindevent:"live",hovershow:300}
var opt=$.extend(true,defaults,options||{});var reclock=[6,5,10,9,8,1,12,11,4,3,2,7,6];function posclock(clock){return reclock[clock];}
var templeteStr="";switch(opt.templete){case 1:templeteStr=' <div class="poptip tip-light poptip-'+opt.skin+'" '
+' style="display: none;" id="poptip'+opt.templete+'">'
+'     <div class="tip-arrow tip-arrow-'+posclock(opt.place)+'">'
+'         <em>◆</em>'
+'         <i>◆</i>'
+'     </div>'
+'     <div class="tip-content">'
+'         <h5 class="tip-title"></h5>'
+'         <p></p>'
+'     </div>'
+' </div>';break;default:break;}
if($("#poptip"+opt.templete).length==0){$("body").append(templeteStr);}
var triggerObj=this;$(this)[opt.bindevent](opt.trigger,function(){var title=$(this).attr("tip-title");var content=$(this).attr("tip-content");var obj=$("#poptip"+opt.templete);clearTimeout(triggerObj.timeId);obj.hide();if(title){obj.find(".tip-title").html(title).show();}else{if(opt.tiptitle){obj.find(".tip-title").html(opt.tiptitle).show();}else{obj.find(".tip-title").html("").hide();}}
if(opt.skin!='default'){$("#poptip"+opt.templete).attr('class','poptip tip-light poptip-'+opt.skin);}else{$("#poptip"+opt.templete).attr('class','poptip tip-light poptip-default');}
if(content){obj.find(".tip-content>p").html(content);}else{obj.hide();return;}
var left=$(this).offset().left;var top=$(this).offset().top;var posdiff=7;switch(opt.place){case 12:case 0:left-=(obj.outerWidth()-$(this).outerWidth())/2;top-=$(obj).outerHeight()+posdiff;break;case 1:left-=$(obj).outerWidth()-$(this).outerWidth();top-=$(obj).outerHeight()+posdiff;break;case 2:left+=$(this).outerWidth()+posdiff;break;case 3:left+=$(this).outerWidth()+posdiff;top-=($(obj).outerHeight()-$(this).outerHeight())/2;break;case 4:left+=$(this).outerWidth()+posdiff;top-=$(obj).outerHeight()-$(this).outerHeight();break;case 5:left-=$(obj).outerWidth()-$(this).outerWidth();top+=$(this).outerHeight()+posdiff;break;case 6:left-=(obj.outerWidth()-$(this).outerWidth())/2;top+=$(this).outerHeight()+posdiff;break;case 7:default:top+=$(this).outerHeight()+posdiff;break;case 8:left-=$(obj).outerWidth()+posdiff;top-=$(obj).outerHeight()-$(this).outerHeight();break;case 9:left-=$(obj).outerWidth()+posdiff;top-=($(obj).outerHeight()-$(this).outerHeight())/2;break;case 10:left-=$(obj).outerWidth()+posdiff;break;case 11:top-=$(obj).outerHeight()+posdiff;break;}
obj.find(".tip-arrow").attr("class","tip-arrow tip-arrow-"+posclock(opt.place)).end().css({left:left+opt.offsetX,top:top+opt.offsetY}).fadeIn(200);})[opt.bindevent]("mouseleave",function(){triggerObj.timeId=setTimeout(function(){$("#poptip"+opt.templete).hide();},opt.hovershow);$("#poptip"+opt.templete).data("timeId",triggerObj.timeId);});$("#poptip"+opt.templete).mouseenter(function(){clearTimeout(triggerObj.timeId);}).mouseleave(function(){$(this).hide();});};})(jQuery);
;var $completeInput=null;(function($){var keys={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};var searchType=["SCENICTOUR","GROUP","FREETOUR","LOCAL","TICKET","HOTEL","ROUTE","VISA","LOCALPLAY"];var recommentListModel="<li class=\"js_recom\"><a href='$href'><p>查看<b>$searchValue</b>$typeName</p></a></li>",matchListModel="<li class=\"js_match\"><a href='$href' data-place='$searchPlace'>$searchValue</a></li>",nodataModel="<li class=\"complete_no\">找不到结果:<b>$searchKey</b></li>";var $elements,$activedElement,timeoutId;var querySelecter={searchType:".js_btn_type",completeBox:".complete_box",completeUl:".complete_list",hotTips:".search_hot_tips",fromPlace:".search_type_list"};function Factory(){$elements=this;return new searchComplete();}
Factory.searchAndJump=function(datatype,cityid,place,triggerType){datatype=(datatype==null||datatype=="undefined")?$(querySelecter.searchType).find("b").attr("data-type").toLowerCase():datatype;cityid=(cityid==null||cityid=="undefined")?$(querySelecter.fromPlace).filter(":visible").find(".js_searchbox>b").attr("data-id"):cityid;var $input=($activedElement!=null&&$activedElement!="undefined")?$activedElement:$(".search_type_box").find("input:visible");if($.trim($input.val())==''){$input.val('').focus();return;}
place=(place==null||place=="undefined")?encodeURIComponent($input.val()):place;var placeID=window.location.href.match(/K\d+/)?window.location.href.match(/K\d+/)[0].replace("K",""):$.xcookie.getCookie("_ip_city_place_id");var url="";if(place=="帐篷客"||place=="安吉帐篷客"||place=="zhangpengke"){if(datatype.toLowerCase()=="all"||datatype.toLowerCase()=="route"){var d=new Date();d.setDate(d.getDate()+1);var d1month=d.getMonth()+1;var d1=''+d.getFullYear()+(d1month>=10?d1month:("0"+d1month))+(d.getDate()>=10?d.getDate():("0"+d.getDate()));d.setDate(d.getDate()+1);var d2month=(d.getMonth()+1);var d2=''+d.getFullYear()+(d2month>=10?d2month:("0"+d2month))+(d.getDate()>=10?d.getDate():("0"+d.getDate()));url="http://s.lvmama.com/hotel/U686C"+d1+"O"+d2+"?keyword=帐篷客&mdd=安吉,湖州,浙江";window.location.href=url;return;}}
if(datatype.toLowerCase()!="ship"){if(cityid==null||cityid=="undefined"||datatype.toLowerCase()==="ticket"||datatype.toLowerCase()==="scenictour"){if(datatype.toLowerCase()==="scenictour"){url="http://s.lvmama.com/scenictour/"+(placeID?"K"+placeID:"")+"?keyword="+place+(triggerType?(triggerType=="button"?"&k=0":"&k=2"):"")+"#list";}else{url="http://s.lvmama.com/"+datatype+"/"+(placeID?"K"+placeID:"")+"?keyword="+place+(triggerType?(triggerType=="button"?"&k=0":"&k=2"):"")+"#list";}}else{url="http://s.lvmama.com/"+datatype+"/H"+cityid+(placeID?"K"+placeID:"")+"?keyword="+place+(triggerType?(triggerType=="button"?"&k=0":"&k=2"):"")+"#list";};}else if(datatype.toLowerCase()=="visa"){url="http://s.lvmama.com/visa/?keyword="+place;}else{url="http://www.lvmama.com/youlun/line-"+place+".html";}
if(url!=window.location.href)
window.location.href=url;else
window.location.reload();}
function timeoutFn(){var fn=new searchComplete("none");fn.requestData();}
function searchComplete(option){if(option)
return;this.initialize();return $elements;}
searchComplete.prototype={initialize:function(){var that=this;that.createContainer();that.bindEvent();},createContainer:function(){var html="<div class=\"complete_box\" style=\"display:none\"><ul class=\"complete_list\"></ul></div>";if($(querySelecter.completeBox).size()<=0)
$("body").append(html);},bindEvent:function(){var that=this;that.bindKeyupEvent();that.bindFoucsEvent();that.bindBlurEvent();},bindKeyupEvent:function(){var that=this;$elements.bind("keydown",function(e){switch(e.which){case keys.RETURN:e=e||window.event;if(!e.preventDefault())
e.returnValue=false;break;}});$elements.bind("keyup",function(e){switch(e.which){case keys.UP:that.moveUp();break;case keys.DOWN:that.moveDown();break;case keys.ESC:$(querySelecter.completeBox).hide();$(querySelecter.hotTips).hide();break;case keys.RETURN:that.select(e);break;default:$(querySelecter.hotTips).hide();clearTimeout(timeoutId);timeoutId=setTimeout(timeoutFn,300);break;}});},bindFoucsEvent:function(){var that=this;var oldValue=['请输入目的地、主题、或关键词','请输入目的地、主题、或关键词','请输入目的地、主题、或关键词','请输入目的地、主题、或关键词','请输入目的地、主题、或关键词','请输入目的地、主题或景区名称','请输入航线、邮轮公司或邮轮名称','请输入您需要签证的国家/地区','请输入目的地、主题、或关键词'];for(var i=0;i<$elements.length;i++){$elements.eq(i).attr('num',i);}
$elements.bind("focus",function(e){$(querySelecter.completeBox).hide();for(var i=0;i<oldValue.length;i++){if($(this).val()==oldValue[i]){$(this).val('').css('color','#333');$(this).removeClass("empty");}}
var target=e.target||window.event.srcElement;$activedElement=$(target);var UlPosition={left:$activedElement.offset().left,top:$activedElement.offset().top+$activedElement.outerHeight()};var UlWidth=$activedElement.outerWidth();if($(querySelecter.searchType).find("b").attr("data-type").toUpperCase()==="SHIP"){UlWidth+=98;}
if($(querySelecter.searchType).find("b").attr("data-type").toUpperCase()==="ROUTE"){UlWidth=462;}
$(querySelecter.completeBox).css({width:UlWidth,left:UlPosition.left,top:UlPosition.top});if(!that.hasValue()&&$(querySelecter.searchType).find("b").attr("data-type").toUpperCase()==="ROUTE"){$(querySelecter.hotTips).show();}else{$(querySelecter.hotTips).hide();that.requestData();}
$completeInput=$(this);});$elements.bind("blur",function(e){var num=$(this).attr('num');if($(this).val()==''){$(this).val(oldValue[num]).css('color','#bbb');}});$elements.bind("click",function(e){that.cancelBubble(e);});},bindBlurEvent:function(){},bindMouseEvent:function(){},moveDown:function(){var that=this;if(!that.hasValue()){return;}
var $libox=$(querySelecter.completeUl);var $activeLi=$libox.find("li.active");$activeLi.size()>0?($activeLi.next().size()>0?$activeLi.removeClass("active").next().addClass("active"):$activeLi.removeClass("active").siblings(":first").addClass("active")):$libox.find("li:first").addClass("active");var $actived=$libox.find("li.active");if($actived.hasClass("js_match"))
$activedElement.val($actived.find("a").attr("data-place"));},moveUp:function(){var that=this;if(!that.hasValue()){return;}
var $libox=$(querySelecter.completeUl);var $activeLi=$libox.find("li.active");$activeLi.size()>0?($activeLi.prev().size()>0?$activeLi.removeClass("active").prev().addClass("active"):$activeLi.removeClass("active").siblings(":last").addClass("active")):$libox.find("li:last").addClass("active");var $actived=$libox.find("li.active");if($actived.hasClass("js_match"))
$activedElement.val($actived.find("a").attr("data-place"));},select:function(e){var $activedLink=$(querySelecter.completeUl).find("li.active>a");searchStatistics();if($activedLink.size()>0){window.location.href=$activedLink.attr("href");}else{var $list=$(".complete_box_all:visible .active[data-url][data-search-value]");if($list.length>0){var city=$list.attr("data-search-value");var url=$list.attr("data-url");window.setHistory(city);window.location.href=url;}else{Factory.searchAndJump(null,null,null,"button");}}},hasValue:function(){if($.trim($activedElement.val())==="")
return false;else
return true;},cancelBubble:function(e){e=e||window.event;if(!e.stopPropagation())
e.cancelBubble=true;},requestData:function(){var that=this;var searchType=$(querySelecter.searchType).find("b").attr("data-type").toLowerCase();if(!that.hasValue()){$(querySelecter.completeBox).hide();if(!that.hasValue()&&searchType==="route")
$(querySelecter.hotTips).show();return;}
var ajaxurl="http://s.lvmama.com/autocomplete/autoCompleteNew.do";var ajaxDate="type="+searchType.toUpperCase()+"&keyword="+$activedElement.val();if(searchType==="ship"){ajaxurl="http://s.lvmama.com/autocomplete/lineShipAutocomplete.do";}else if(searchType==="visa"){ajaxurl="http://s.lvmama.com/autocomplete/autoCompleteVisa.do";}else if(searchType==="route"){searchType="global";var cityId=$(".search_type_list:visible .js_searchbox b").attr("data-id");if(cityId&&cityId!==''){ajaxDate+="&fromDestId="+cityId}}
$.ajax({url:ajaxurl,type:"get",dataType:"jsonp",jsonpCallback:"recive",data:ajaxDate,success:function(response){that.dataBind(response);},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("jsonpError:"+errorThrown);}});function recive(response){}},dataBind:function(data){if(!(typeof data==="object"))
return;var html="",url;var datatype=$(querySelecter.searchType).find("b").attr("data-type").toLowerCase();var cityid=$(querySelecter.fromPlace).filter(":visible").find(".js_searchbox>b").attr("data-id");var placeID=window.location.href.match(/K\d+/)?window.location.href.match(/K\d+/)[0].replace("K",""):$.xcookie.getCookie("_ip_city_place_id");if(datatype==="route"){var allHtml=this.dataBindAll(data.matchList[0]);html+=allHtml}
var matchHtml=[];if(data.matchList&&datatype!="ship"&&datatype!="visa"){$.each(data.matchList,function(index,items){if(cityid==null||cityid=="undefined"||items.type.toLowerCase()==="ticket"||datatype.toLowerCase()==="scenictour"){if(datatype.toLowerCase()==="scenictour"){url="http://s.lvmama.com/scenictour/"+(placeID?"K"+placeID:"")+"?keyword="+encodeURI(items.searchValue)+"&k=1#list";}else{url="http://s.lvmama.com/"+items.type.toLowerCase()+"/"+(placeID?"K"+placeID:"")+"?keyword="+encodeURI(items.searchValue)+"&k=1#list";}}else{if(items.searchValue=="帐篷客"||items.searchValue=="安吉帐篷客"||items.searchValue=="zhangpengke"){if(items.type.toLowerCase()=="all"||items.type.toLowerCase()=="route"){var d=new Date();d.setDate(d.getDate()+1);var d1=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();d.setDate(d.getDate()+1);var d2=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();url="http://hotels.lvmama.com/list/%E5%B8%90%E7%AF%B7%E5%AE%A2%20%E5%AE%89%E5%90%89%E6%BA%AA%E9%BE%99%E8%8C%B6%E8%B0%B7%E5%BA%A6%E5%81%87%E9%85%92%E5%BA%97,%E5%AE%89%E5%90%89%E5%8E%BF.html?longitude=119.780578&latitude=30.746796&beginBookTime="+d1+"&endBookTime="+d2+"&parentId=686&searchId=169939";}}
else
url="http://s.lvmama.com/"+items.type.toLowerCase()+"/H"+cityid+(placeID?"K"+placeID:"")+"?keyword="+encodeURI(items.searchValue)+"&k=1#list";}
matchHtml.push(matchListModel.replace("$href",url).replace("$searchValue",items.searchValue.replace(new RegExp('('+$activedElement.val()+")","g"),"<span>$1</span>")).replace("$searchPlace",items.searchValue));});}else if(datatype=="visa"){for(var i=0;i<data.length;i++){url="http://s.lvmama.com/visa/?keyword="+data[i];matchHtml.push(matchListModel.replace("$href",url).replace("$searchValue",data[i].replace(new RegExp('('+$activedElement.val()+")","g"),"<span>$1</span>")).replace("$searchPlace",data[i]));}}else{for(var i=0;i<data.length;i++){url="http://www.lvmama.com/youlun/line-"+data[i]+".html";matchHtml.push(matchListModel.replace("$href",url).replace("$searchValue",data[i].replace(new RegExp('('+$activedElement.val()+")","g"),"<span>$1</span>")).replace("$searchPlace",data[i]));}}
html+=matchHtml.join('');if(html===""){$(querySelecter.completeBox).hide();return;}
$(querySelecter.completeBox).show().find(querySelecter.completeUl).html(html);$(".search_all_mdd").hide();if(datatype==="route"){$(querySelecter.completeBox).addClass("complete_box_all");}else{$(querySelecter.completeBox).removeClass("complete_box_all");}},dataBindAll:function(data){var $input=$(".search_type_list:visible .form_search input");if(!data){return"";}
var searchValue=data.searchValue;var templateAll='\n'+'{{routes}}'+'{{tickets}}'+'{{hotels}}'+'{{ships}}'+'{{visas}}';var routesAllTemplate='<li class="item" data-search-value="{{searchValue}}" data-url="{{url}}">'+'<div class="result">约{{typeCount}}个结果</div>'+'<div class="blank"><i class="icon-product"></i></div>'+'<em>{{searchValue}}</em>的全部旅游产品'+'</li>';var routesTemplate='<li class="item item-sub" data-search-value="{{searchValue}}" data-url="{{url}}">'+'<div class="result">约{{typeCount}}个结果</div>'+'<div class="blank"></div>'+'查看 <em>{{searchValue}}</em>{{type}}'+'</li>';var ticketTemplate='<li class="item" data-search-value="{{searchValue}}" data-url="{{url}}">'+'<div class="result">约{{typeCount}}个结果</div>'+'<div class="blank"><i class="icon-view"></i></div>'+'<em>{{searchValue}}</em>的全部景点门票'+'</li>';var hotelTemplate='<li class="item" data-search-value="{{searchValue}}" data-url="{{url}}">'+'<div class="result">约{{typeCount}}个结果</div>'+'<div class="blank"><i class="icon-hotel"></i></div>'+'<em>{{searchValue}}</em>的全部酒店'+'</li>';var shipTemplate='<li class="item" data-search-value="{{searchValue}}" data-url="{{url}}">'+'<div class="result">约{{typeCount}}个结果</div>'+'<div class="blank"><i class="icon-ship"></i></div>'+'<em>{{searchValue}}</em>的全部邮轮'+'</li>';var visaTemplate='<li class="item" data-search-value="{{searchValue}}" data-url="{{url}}">'+'<div class="result">约{{typeCount}}个结果</div>'+'<div class="blank"><i class="icon-visa"></i></div>'+'<em>{{searchValue}}</em>的全部签证'+'</li>';var routesTemplateTable={NORMAL:routesTemplate,ROUTE:routesAllTemplate};var typeTable={SCENICTOUR:"酒店+景点",GROUP:"跟团游",LOCAL:"当地游",AROUND:"周边跟团游",ZIYOUXING:"自由行"};var routes=data.routes;var routesHtml="";if(routes){for(var routeIndex=0;routeIndex<routes.length;routeIndex++){var route=routes[routeIndex];var type=route.type;var typeCount=route.typeCount;var routeUrl=route.url;var template=routesTemplateTable[type.toUpperCase()];if(!template){template=routesTemplateTable["NORMAL"];}
if(type.toUpperCase()==="ROUTE"){$input.attr("data-url","http://s.lvmama.com/"+routeUrl)}
routesHtml+=this.replaceWith(template,{type:typeTable[type.toUpperCase()],typeCount:typeCount,destName:searchValue,url:"http://s.lvmama.com/"+routeUrl,searchValue:searchValue});}}
var ticket=data.tickets;var ticketsHtml="";if(ticket){var ticketTypeCount=ticket.typeCount;var ticketUrl=ticket.url;ticketsHtml=this.replaceWith(ticketTemplate,{typeCount:ticketTypeCount,destName:searchValue,url:"http://s.lvmama.com/"+ticketUrl,searchValue:searchValue});}
var hotel=data.hotels;var hotelsHtml="";if(hotel){var hotelTypeCount=hotel.typeCount;var hotelUrl=hotel.url;hotelsHtml=this.replaceWith(hotelTemplate,{typeCount:hotelTypeCount,destName:searchValue,url:"http://s.lvmama.com/"+hotelUrl,searchValue:searchValue});}
var ship=data.ships;var shipsHtml="";if(ship){var shipTypeCount=ship.typeCount;var shipUrl=ship.url;shipsHtml=this.replaceWith(shipTemplate,{typeCount:shipTypeCount,destName:searchValue,url:"http://s.lvmama.com/"+shipUrl,searchValue:searchValue});}
var visa=data.visas;var visasHtml="";if(visa){var visaTypeCount=visa.typeCount;var visaUrl=visa.url;visasHtml=this.replaceWith(visaTemplate,{typeCount:visaTypeCount,destName:searchValue,url:"http://s.lvmama.com/"+visaUrl,searchValue:searchValue});}
var html=this.replaceWith(templateAll,{routes:routesHtml,tickets:ticketsHtml,hotels:hotelsHtml,visas:visasHtml,ships:shipsHtml});return html;},replaceWith:function(str,obj){for(var i in obj){str=this.replaceAll(str,"{{"+i+"}}",obj[i]);}
return str;},replaceAll:function(src,match,str){var result=src.indexOf(match);while(result>0){src=src.replace(match,str);result=src.indexOf(match)}
return src;}};$.fn.searchComplete=$.searchComplete=Factory;}(jQuery));(function($){if($('body').hasClass('home')){return false;}
var keys={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};var destinationModel="<li><a href='javascript:;' data-place=\"$searchData\" data-id=\"$searchID\"><span class=\"place-name\">$searchName</span><span class=\"hotel-count\">约$searchCount家酒店</span><span class=\"hotel-place-type\">$searchType</span></a></li>",keywordModel="<li><a href='javascript:;' data-place=\"$searchData\"><span class=\"hotel-name\">$searchName</span><span class=\"hotel-count\">约$searchCount家酒店</span><span class=\"hotel-place-lcat\">$searchType</span></a></li>";var $elements,$activedElement,timeoutId;var querySelecter={searchType:".js_btn_type",completeBox:".complete_box_hotel",destinationBox:".hotelDestBox",keywordBox:".hotelKeywordBox",errorTipsBox:".complete_error_tips",destInput:".js_searchDest",keywordInput:".js_searchKeyword",hotDestination:".search_hotel_mdd",hotKeyword:".search_hotel_keyword",nodestTip:".lv_search_tips"};var cityName=$('#currentCity');$(querySelecter.destInput).val(cityName.attr('data-city-name')).attr('data-id',cityName.attr('data-id'));var oldValue=['请输入国内或海外目的地','酒店名称/地标/商圈'];function Factory(){$elements=this;return new searchComplete();}
Factory.searchAndJump=function(){var id=$(querySelecter.destInput).attr("data-id");if(!id){$(querySelecter.nodestTip).show();return;}
var d=new Date();var newD=d.setDate(d.getDate()+1);var d2=new Date(newD);var tomorrow={year:d2.getFullYear(),month:(d2.getMonth()+1)<10?"0"+(d2.getMonth()+1):(d2.getMonth()+1),day:d2.getDate()<10?"0"+d2.getDate():d2.getDate()};var tomorrowStr=tomorrow.year.toString()+tomorrow.month.toString()+tomorrow.day.toString();var newD3=d2.setDate(d2.getDate()+1);var d3=new Date(newD3);var tomorrow2={year:d3.getFullYear(),month:(d3.getMonth()+1)<10?"0"+(d3.getMonth()+1):(d3.getMonth()+1),day:d3.getDate()<10?"0"+d3.getDate():d3.getDate()};var tomorrowStr2=tomorrow2.year.toString()+tomorrow2.month.toString()+tomorrow2.day.toString();var dest=$(querySelecter.destInput).val();var keyword=$(querySelecter.keywordInput).val();if(dest==oldValue[0]){$(querySelecter.destInput).focus();return;}
keyword=$.trim(keyword)=="酒店名称/地标/商圈"?"":keyword;var url="http://s.lvmama.com/hotel/U"+id+"C"+tomorrowStr+"O"+tomorrowStr2+"?keyword="+encodeURIComponent(keyword)+"&mdd="+dest;window.location.href=url;}
function timeoutFn(){var fn=new searchComplete("none");fn.requestData();}
function searchComplete(option){if(option)
return;this.initialize();return $elements;}
searchComplete.prototype={initialize:function(){var that=this;that.createContainer();that.bindEvent();},createContainer:function(){var html=[];html.push("<div class=\"complete_box_hotel hotelDestBox\" style=\"display:none\"></div>");html.push("<div class=\"complete_box_hotel hotelKeywordBox\" style=\"display:none\"></div>");html.push("<div class=\"complete_error_tips\" style=\"display:none;\"><span>找不到目的地：</span><span class=\"word\"></span><i>×</i></div>");if($(querySelecter.destinationBox).size()<=0)
$("body").append(html.join(''));},bindEvent:function(){var that=this;that.bindKeyupEvent();that.bindFoucsEvent();that.bindBlurEvent();that.bindMouseEvent();},bindKeyupEvent:function(){var that=this;$elements.bind("keydown",function(e){switch(e.which){case keys.RETURN:e=e||window.event;if(!e.preventDefault())
e.returnValue=false;break;}});$elements.bind("keyup",function(e){switch(e.which){case keys.UP:that.moveUp();break;case keys.DOWN:that.moveDown();break;case keys.ESC:$(querySelecter.completeBox).hide();break;case keys.RETURN:if($(querySelecter.completeBox).is(":visible")){that.select(e);}
break;default:clearTimeout(timeoutId);timeoutId=setTimeout(timeoutFn,300);break;}});},bindFoucsEvent:function(){var that=this;for(var i=0;i<$elements.length;i++){$elements.eq(i).attr('num',i);}
$elements.bind("focus",function(e){for(var i=0;i<oldValue.length;i++){if($(this).val()==oldValue[i]){$(this).val('').css('color','#666');}}
var target=e.target||window.event.srcElement;$activedElement=$(target);var UlPosition={left:$activedElement.offset().left,top:$activedElement.offset().top+$activedElement.outerHeight()};var UlWidth=$activedElement.outerWidth();var $targetBox=that.getActivedBox();$targetBox.css({left:UlPosition.left,top:UlPosition.top});if($activedElement.is(querySelecter.keywordInput)){$(querySelecter.hotDestination).hide();$(querySelecter.destinationBox).hide();}
if($activedElement.val()==""&&$activedElement.is(querySelecter.destInput)){$(querySelecter.hotDestination).show();$(querySelecter.nodestTip).hide();}
else if($activedElement.val()==""&&$activedElement.is(querySelecter.keywordInput)){that.requestHotKeyword();}
else if($activedElement.val()!=="")
that.requestData();$("input:text[active]").removeAttr("active");$(target).attr("active","actived");$completeInput=$(this);});$elements.bind("blur",function(e){var num=$(this).attr('num');if($(this).val()==''){$(this).val(oldValue[num]).css('color','#666');}});$elements.bind("click",function(e){that.cancelBubble(e);});},bindBlurEvent:function(){},changeInputValue:function($li){var $dest=$(querySelecter.destInput);var $link=$li.find("a");var place=$link.attr("data-place");var placeId=$link.attr("data-id");var type=$li.find(".hotel-place-type").html();var placeArr=place.split(',');var lastIndex=placeArr.length-1;var lastItem;if(lastIndex){lastItem=placeArr[lastIndex];}else{lastItem="";}
var firstItem=placeArr[0];var $searchTypeList=$activedElement.parents(".search_type_list");var $searchKeyword=$searchTypeList.find(".js_searchKeyword");if(placeArr.length===1){$activedElement.val(firstItem);}else{$activedElement.val(lastItem);$searchKeyword.val(firstItem);}
if(type==="行政区"){$activedElement.val(place);$searchKeyword.val("");}
$dest.attr("data-id",placeId);},bindMouseEvent:function(){var that=this;$(querySelecter.completeBox).bind("mousedown",function(e){e=e||window.event;var $li;var $target=$(e.target);if($target.is("li")){$li=$target;}else{$li=$target.parents("li").eq(0);}
that.changeInputValue($li);that.getActivedBox().hide();});$(querySelecter.errorTipsBox).find("i").bind("mousedown",function(){$(this).parent().hide();});},moveDown:function(){var that=this;if(!that.hasValue()){return;}
var $libox=that.getActivedBox();var $activeLi=$libox.find("li.active");var t=$activeLi.size()>0?($activeLi.next().size()>0?$activeLi.removeClass("active").next().addClass("active"):$activeLi.removeClass("active").siblings(":first").addClass("active")):$libox.find("li:first").addClass("active");var $actived=$libox.find("li.active");that.changeInputValue($actived);},moveUp:function(){var that=this;if(!that.hasValue()){return;}
var $libox=that.getActivedBox();var $activeLi=$libox.find("li.active");var t=$activeLi.size()>0?($activeLi.prev().size()>0?$activeLi.removeClass("active").prev().addClass("active"):$activeLi.removeClass("active").siblings(":last").addClass("active")):$libox.find("li:last").addClass("active");var $actived=$libox.find("li.active");that.changeInputValue($actived);},select:function(e){var $activedLink=this.getActivedBox().find("li.active>a");if($activedLink.size()>0){this.changeInputValue($activedLink.parents("li").eq(0));}
$(querySelecter.completeBox).hide();},hasValue:function(){if($.trim($activedElement.val())==="")
return false;else
return true;},getActivedBox:function(){return $activedElement.is(querySelecter.destInput)?$(querySelecter.destinationBox):$(querySelecter.keywordBox);},cancelBubble:function(e){e=e||window.event;if(!e.stopPropagation())
e.cancelBubble=true;},requestHotKeyword:function(){var that=this;$(querySelecter.hotKeyword).html("");var disID=$(querySelecter.destInput).attr("data-id");var dataStr="type=REC&districtId="+disID;$.ajax({url:"http://s.lvmama.com/autocomplete/autoCompleteHotel.do",type:"post",dataType:"jsonp",jsonpCallback:"recive",data:dataStr,success:function(response){that.renderHotKeyword(response);},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("jsonpError:"+errorThrown);}});function recive(response){}},renderHotKeyword:function(response){var html=[];if(response.traffic&&response.traffic.length>0){html.push("<dl class=\"keyword_list\"><dt>交通枢纽</dt><dd>");$.each(response.traffic,function(index,item){html.push("<a href=\"javascript:;\">"+item.searchValue+"</a>");});html.push("</dd></dl>");}
if(response.metro&&response.metro.length>0){html.push("<dl class=\"keyword_list\"><dt>地铁站</dt><dd>");$.each(response.metro,function(index,item){html.push("<a href=\"javascript:;\">"+item.searchValue+"</a>");});html.push("</dd></dl>");}
if(response.business&&response.business.length>0){html.push("<dl class=\"keyword_list\"><dt>热门商圈</dt><dd>");$.each(response.business,function(index,item){html.push("<a href=\"javascript:;\">"+item.searchValue+"</a>");});html.push("</dd></dl>");}
if(html.length>0){$(querySelecter.hotKeyword).html(html.join('')).show();}},requestData:function(){var that=this;$(querySelecter.hotDestination).hide();if(!that.hasValue()){that.getActivedBox().hide();$(querySelecter.errorTipsBox).hide();if($activedElement.is(querySelecter.destInput))
$(querySelecter.hotDestination).show();return;}
if($activedElement.is(querySelecter.destInput)){$(querySelecter.destInput).removeAttr("data-id");$(querySelecter.errorTipsBox).hide();}
var keyword=$activedElement.val();var dataStr=$activedElement.is(querySelecter.destInput)?("type=DEST&keyword="+keyword.split(",")[0]):("type=HOTEL&keyword="+keyword+"&districtId="+$(querySelecter.destInput).attr("data-id"));var ajaxurl="http://s.lvmama.com/autocomplete/autoCompleteHotel.do";$.ajax({url:ajaxurl,type:"post",dataType:"jsonp",jsonpCallback:"recive",data:dataStr,success:function(response){that.dataBind(response);},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("jsonpError:"+errorThrown);}});function recive(response){}},dataBind:function(data){var that=this;if(!(typeof data==="object"))
return;var html="";if(data.matchList){if(that.getActivedBox().is(querySelecter.destinationBox)){var canton=[],scenic=[];$.each(data.matchList,function(index,items){var finalModel=destinationModel.replace("$searchData",items.trueDistrictAlias);finalModel=finalModel.replace("$searchID",items.districtId);finalModel=finalModel.replace("$searchName",items.districtAlias.replace(new RegExp('('+data.keyword+")","g"),"<b>$&</b>"));if(items.hotelCount==null||items.hotelCount==0){finalModel=finalModel.replace("约$searchCount家酒店","");}
else
finalModel=finalModel.replace("$searchCount",items.hotelCount);finalModel=finalModel.replace("$searchType",items.type);if(items.type=="行政区")
canton.push(finalModel);else{scenic.push(finalModel);}});if(scenic.length>0&&canton.length>0){scenic[0]=scenic[0].replace("li","li class=\"divide-line\"");}
if(canton.length==0&&scenic.length==0)
html="";else
html="<ul>"+canton.join('')+scenic.join('')+"</ul>";}else{var matchHtml=[],tempKeywordModel="";$.each(data.matchList,function(index,items){tempKeywordModel=keywordModel;if(items.hotelCount==null||items.hotelCount==0){tempKeywordModel=tempKeywordModel.replace("约$searchCount家酒店","");}
matchHtml.push(tempKeywordModel.replace("$searchData",items.name).replace("$searchCount",items.hotelCount).replace("$searchName",items.name.replace(new RegExp('('+data.keyword+")","g"),"<b>$1</b>")).replace("$searchType",items.type));});html=matchHtml.length>0?("<ul>"+matchHtml.join('')+"</ul>"):"";}}
if(html===""){that.getActivedBox().hide();if($activedElement.is(querySelecter.destInput)){var thisL=$activedElement.offset().left,thisT=$activedElement.offset().top,thisH=$activedElement.outerHeight(true);$(querySelecter.errorTipsBox).show().css({'left':thisL,'top':thisT+thisH}).find(".word").text($activedElement.val());}
return;}
that.getActivedBox().show().html(html);if($activedElement.is(querySelecter.destInput)){var $a=that.getActivedBox().find("li:first").addClass("active").find("a");$(querySelecter.destInput).attr("data-id",$a.attr("data-id"));}}};$.fn.searchComplete_hotelAddon=$.searchComplete_hotelAddon=Factory;}(jQuery));$(function(){var $document=$(document);function replaceWith(str,obj){for(var i in obj){str=replaceAll(str,"{{"+i+"}}",obj[i]);}
return str;}
function replaceAll(src,match,str){var result=src.indexOf(match);while(result>0){src=src.replace(match,str);result=src.indexOf(match)}
return src;}
var templateCities={hot:{main:'<div class="search-station-hot">'+'<h4>热门出发城市</h4>'+'<div class="list clearfix">'+'{{links}}'+'</div>'+'</div>',link:'<a data-id="{{hotDistrictId}}" data-name="{{hotDistrictName}}" data-code="{{hotDistrictCode}}">{{hotDistrictName}}</a>'},main:'<div class="search-station-cities">'+'<ul class="nav-tabs clearfix">'+'<li class="active">ABCD<i></i></li>'+'<li>EFGH<i></i></li>'+'<li>JKLM<i></i></li>'+'<li>NOPQRS<i></i></li>'+'<li>TUVWX<i></i></li>'+'<li>YZ<i></i></li>'+'</ul>'+'<ul class="tab-contents">'+'{{lists}}'+'</ul>'+'</div>',list:'<li class="search-station-cities-pane">'+'{{dls}}'+'</li>',dl:'<dl class="clearfix">'+'<dt>{{alpha}}</dt>'+'<dd class="clearfix">'+'{{links}}'+'</dd>'+'</dl>',link:'<a class="city" data-id="{{districtId}}" data-name="{{districtName}}" data-code="{{districtCode}}">{{districtName}}</a>'};var url="http://www.lvmama.com/seo_api/departureList/getDepartVo.do?channel=zhuzhan&jsoncallback=recive";$.ajax({url:url,dataType:"jsonp",jsonpCallback:"recive"}).done(function(data){renderCity(data);}).fail(function(err){});function renderCity(data){var coreData=data;var title=[["A","B","C","D"],["E","F","G","H","I"],["J","K","L","M"],["N","O","P","Q","R","S"],["T","U","V","W","X"],["Y","Z"]];var listsHtml="";for(var i=0;i<title.length;i++){var sub=title[i];var dlsHtml="";for(var j=0;j<sub.length;j++){var alpha=sub[j];var alphaData=coreData[alpha];if(!alphaData||alphaData.length==0){continue;}
var linksHtml="";for(var k=0;k<alphaData.length;k++){var item=alphaData[k];var districtId=item.districtId;var districtName=item.districtName;var districtShortPinYin=item.shortPinYin.toUpperCase();linksHtml+=replaceWith(templateCities.link,{districtId:districtId,districtName:districtName,districtCode:districtShortPinYin})}
dlsHtml+=replaceWith(templateCities.dl,{links:linksHtml,alpha:alpha})}
listsHtml+=replaceWith(templateCities.list,{dls:dlsHtml})}
var cityHtml=replaceWith(templateCities.main,{lists:listsHtml});var hotLinksHtml="";var hot=coreData.hot;if(!hot){return}
for(var hotIndex=0;hotIndex<hot.length;hotIndex++){var hotCity=hot[hotIndex];var hotDistrictId=hotCity.districtId;var hotDistrictName=hotCity.districtName;var hotDistrictShortPinYin=hotCity.shortPinYin.toUpperCase();hotLinksHtml+=replaceWith(templateCities.hot.link,{hotDistrictId:hotDistrictId,hotDistrictName:hotDistrictName,hotDistrictCode:hotDistrictShortPinYin});}
hotLinksHtml='<a data-code="SH" data-id="9" data-name="上海">上海</a> <a data-code="SZ" data-id="60" data-name="苏州">苏州</a> <a data-code="HZ" data-id="69" data-name="杭州">杭州</a> <a data-code="BJ" data-id="13" data-name="北京">北京</a> <a data-code="TY" data-id="100" data-name="太原">太原</a> <a data-code="GZ" data-id="322" data-name="广州">广州</a> <a data-code="CD" data-id="258" data-name="成都">成都</a> <a data-code="ZQ" data-id="31" data-name="重庆">重庆</a> <a data-code="SY" data-id="257" data-name="三亚">三亚</a> <a data-code="CZ" data-id="59" data-name="常州">常州</a> <a data-code="HZ" data-id="73" data-name="湖州">湖州</a> <a data-code="QD" data-id="175" data-name="青岛">青岛</a> <a data-code="TJ" data-id="14" data-name="天津">天津</a> <a data-code="SZ" data-id="324" data-name="深圳">深圳</a> <a data-code="KM" data-id="233" data-name="昆明">昆明</a> <a data-code="HK" data-id="221" data-name="海口">海口</a> <a data-code="NJ" data-id="56" data-name="南京">南京</a> <a data-code="JX" data-id="72" data-name="嘉兴">嘉兴</a> <a data-code="NT" data-id="61" data-name="南通">南通</a> <a data-code="WX" data-id="57" data-name="无锡">无锡</a> <a data-code="XA" data-id="256" data-name="西安">西安</a>';var hotHtml=replaceWith(templateCities.hot.main,{links:hotLinksHtml});var $jsAllCity=$('.js_all_city');$jsAllCity.html(hotHtml+cityHtml);$jsAllCity.width(460);}
if(/dujiaseolist/.test($('body').attr('id'))){try{$('.Js_LISTFIRST').html('<p>热门出发城市</p>'+chufa_city);}catch(e){}
if(isNaN(fromDest)&&fromDest){$('.lv_city_box .lv_city').html(fromDest).attr('data-city-name',fromDest);}}
var templateReferral={hot:{html:'<div class="search-hot-destination-season">'+'<h4>你最近在搜：</h4>'+'<div class="list clearfix">'+'{{lists}}'+'</div>'+'</div>',list:'<a>{{name}}</a>'},main:{html:'<div class="search-hot-destination-cities clearfix">'+'<h4>热门推荐：</h4>'+'{{dls}}'+'</div>',dl:'<dl class="clearfix">'+'<dt>{{dlName}}</dt>'+'<dd class="clearfix">'+'<div class="cities-group">'+'{{lists}}'+'</div>'+'</dd>'+'</dl>',list:'<a data-url="{{url}}">{{name}}</a>'}};$document.on("click",function(e){var $target=$(e.target);var isInMdd=$target.parents(".search_all_mdd").length>0;var isMdd=$target.is(".search_all_mdd");if(isInMdd||isMdd){}else{$("#search_all_fromPlaces .search_all_mdd").empty().hide();}});$("#search_all_fromPlaces input").on("click keyup",function(){var $this=$(this);var val=$.trim($this.val());if(val===""){}
function renderCityReferal(data){var historyCities=getHistory();var historyHtml="";if(!historyCities){historyCities="";}else{var historyCityArr=historyCities.split("|");var historyListHtml="";for(historyCityIndex=0;historyCityIndex<historyCityArr.length;historyCityIndex++){var city=historyCityArr[historyCityIndex];if(city&&city!==""){historyListHtml+=replaceWith(templateReferral.hot.list,{name:city});}}
if(historyCityArr.length>0){historyHtml=replaceWith(templateReferral.hot.html,{lists:historyListHtml});}}
if(historyHtml!==""){$(".search_all_mdd").html(historyHtml).show();}}});$document.on("click",".complete_box_all .item",function(e){var $this=$(this);var url=$this.attr("data-url");var city=$this.attr("data-search-value");if(city){setHistory(city);}
searchStatistics(null,city);goToUrl(url);});$document.on("click",".complete_box .js_match a",function(e){var $this=$(this);var url=$this.attr("href");var city=$this.attr("data-place");searchStatistics(null,city);goToUrl(url);});function getHistory(){return $.xcookie.getCookie('_search_complete_all_history');}
function setHistory(city){var searchValues=getHistory();if(!searchValues){searchValues="";}
if(searchValues.indexOf(city)==-1){searchValues=city+"|"+searchValues;var match=searchValues.match(/^(.*?\|){0,10}/);if(match[0]){searchValues=match[0];}
$.xcookie.setCookie('_search_complete_all_history',searchValues,{path:'/',expires:30});}}
window.setHistory=setHistory;function goToUrl(url){window.location.href=url;}
$document.on("click",".search-hot-destination-cities a[data-url]",function(){var $this=$(this);var url=$this.attr("data-url");goToUrl(url);});$document.on("click",".search-hot-destination-season a",function(){var $this=$(this);$.searchComplete.searchAndJump(null,null,$this.text(),'button');return false;});});$(function(){$(window).resize(function(event){if($completeInput!=null){$('.complete_box,.complete_box_hotel,.complete_error_tips').css('left',$completeInput.offset().left);}});});
;/*
 * calendar.js
 * 2016-03-15
 * 2016-06-12
 * Sheng Jiang
 * 1.0.0.0
 */
(function(window,$,lv,nova){"use strict";if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){var T,k;if(this==null){throw new TypeError(' this is null or not defined');}
var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+' is not a function');}
if(arguments.length>1){T=thisArg;}
k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}
k++;}};}
if(lv.calendar){return false;}
var $document=$(document);var $body=$("body");var today=new Date();var fiveMinutes=1000*60*5;var monthSize={0:31,1:28,2:31,3:30,4:31,5:30,6:31,7:31,8:30,9:31,10:30,11:31};function getEpochOfCST(){var epoch=new Date(0);epoch.setHours(0);return epoch;}
function padNumber(num,digits,trim){var neg="";if(num<0){neg="-";num=-num;}
num=""+num;while(num.length<digits){num="0"+num;}
if(trim){num=num.substr(num.length-digits);}
return neg+num;}
function dateGetter(name,size,offset,trim){return function(date){var value=date["get"+name]();if(offset>0||value>-offset){value+=offset;}
if(value===0&&offset===-12){value=12;}
return padNumber(value,size,trim);}}
function dateSetter(name,size,offset,trim){return function(date,value){if(offset>0||value>-offset){value-=offset;}
if(value===0&&offset===-12){value=12;}
date["set"+name](value);}}
var DATE_FORMATS_SPLIT=/((?:[^yMdHhmsaZE']+)|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/;var DATE_FORMATS={yyyy:["FullYear",4],yy:["FullYear",2,0],MM:["Month",2,1],M:["Month",1,1],dd:["Date",2],d:["Date",1],HH:["Hours",2],H:["Hours",1],hh:["Hours",2,-12],h:["Hours",1,-12],mm:["Minutes",2],m:["Minutes",1],ss:["Seconds",2],s:["Seconds",1],E:["Day",1]};function Factory(options){options=$.extend({},Factory.defaults,options);return new Calendar(options);}
Factory.defaults={priceTipText:"因最低价实时变化，请以实际价格为准",showPriceTip:true,sectionSelect:false,allowMutiSelected:false,triggerEvent:"click",date:"",target:"body",offsetAmount:{top:0,left:0},englishWeekTitle:{0:'sun',1:'mon',2:'tue',3:'wed',4:'thu',5:'fri',6:'sat'},weekShortTitle:{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"},wrapClass:"",weekTitle:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},titleTip:"{{year}}年{{month}}月",template:"big",bimonthly:false,dateFormat:"yyyy-MM-dd",monthChangeOffset:1,sourceFn:null,selectDateCallback:null,cancelDateCallback:null,completeCallback:null,clearCallback:null,okCallback:null,renderReadonly:true,cascading:false,cascadingMin:1,cascadingOffset:1,cascadingMax:-1,cascadingNextAuto:true,minLimit:null,maxLimit:null,monthNext:6,monthPrev:0,dayNext:-1,dayPrev:0,dayDisableNext:0,isTodayClick:true,numberOfDays:"{{num}}晚",division:false,showNumberOfDays:false,isBirthday:false,hasTime:false,clickDocumentHide:true,festival:{'2016-01-01':{name:'元旦',vacationName:'元旦'},'2016-02-07':{name:'除夕',vacationName:'除夕'},'2016-02-08':{name:'春节',vacationName:'春节'},'2016-02-09':{vacationName:'春节假期'},'2016-02-10':{vacationName:'春节假期'},'2016-02-11':{vacationName:'春节假期'},'2016-02-12':{vacationName:'春节假期'},'2016-02-13':{vacationName:'春节假期'},'2016-04-02':{vacationName:'清明节假期'},'2016-04-03':{vacationName:'清明节假期'},'2016-04-04':{name:'清明',vacationName:'清明节'},'2016-04-30':{vacationName:'劳动节假期'},'2016-05-01':{name:'劳动',vacationName:'劳动节'},'2016-05-02':{vacationName:'劳动节假期'},'2016-06-09':{name:'端午',vacationName:'端午节'},'2016-06-10':{vacationName:'端午节假期'},'2016-06-11':{vacationName:'端午节假期'},'2016-09-15':{name:'中秋',vacationName:'中秋节假期'},'2016-09-16':{vacationName:'中秋节假期'},'2016-09-17':{vacationName:'中秋节'},'2016-10-01':{name:'国庆',vacationName:'国庆节'},'2016-10-02':{vacationName:'国庆节假期'},'2016-10-03':{vacationName:'国庆节假期'},'2016-10-04':{vacationName:'国庆节假期'},'2016-10-05':{vacationName:'国庆节假期'},'2016-10-06':{vacationName:'国庆节假期'},'2016-10-07':{vacationName:'国庆节假期'},'2016-12-31':{vacationName:'元旦假期'},'2017-01-01':{name:'元旦',vacationName:'元旦'},'2017-01-02':{vacationName:'元旦假期'},'2017-01-27':{name:'除夕',vacationName:'除夕'},'2017-01-28':{name:'春节',vacationName:'春节'},'2017-01-29':{vacationName:'春节假期'},'2017-01-30':{vacationName:'春节假期'},'2017-01-31':{vacationName:'春节假期'},'2017-02-01':{vacationName:'春节假期'},'2017-02-02':{vacationName:'春节假期'},'2017-04-02':{vacationName:'清明节假期'},'2017-04-03':{vacationName:'清明节假期'},'2017-04-04':{name:'清明',vacationName:'清明节'},'2017-04-29':{vacationName:'劳动节假期'},'2017-04-30':{vacationName:'劳动节假期'},'2017-05-01':{name:'劳动',vacationName:'劳动节'},'2017-05-28':{vacationName:'端午节假期'},'2017-05-29':{vacationName:'端午节假期'},'2017-05-30':{name:'端午',vacationName:'端午节'},'2017-10-01':{name:'国庆',vacationName:'国庆节'},'2017-10-02':{vacationName:'国庆节、中秋节假期'},'2017-10-03':{vacationName:'国庆节、中秋节假期'},'2017-10-04':{name:'中秋',vacationName:'中秋节'},'2017-10-05':{vacationName:'国庆节、中秋节假期'},'2017-10-06':{vacationName:'国庆节、中秋节假期'},'2017-10-07':{vacationName:'国庆节、中秋节假期'},'2017-10-08':{vacationName:'国庆节、中秋节假期'}},cascadingEndNotShowStart:false,weekOffset:0,dayOffset:0};function Calendar(options){this.init(options);}
Calendar.now=function(){return new Date();};Calendar.pad=function(number){var r=String(number);if(r.length===1){r='0'+r;}
return r;};Calendar.isSameDay=function(dateA,dateB){if(dateA.getFullYear()!==dateB.getFullYear()){return false;}
if(dateA.getMonth()!==dateB.getMonth()){return false;}
if(dateA.getDate()!==dateB.getDate()){return false;}
return true;};Calendar.isSameMonth=function(dateA,dateB){if(dateA.getFullYear()!==dateB.getFullYear()){return false;}
if(dateA.getMonth()!==dateB.getMonth()){return false;}
return true;};Calendar.isLeapYear=function(fullYear){if((fullYear%400===0)||((fullYear%4===0)&&(fullYear%100!==0))){return true;}else{return false;}};Calendar.dateFormat=function(date,format){var text="";var match;var parts=[];var fn;while(format){match=DATE_FORMATS_SPLIT.exec(format);if(match){parts=parts.concat(match.slice(1));format=parts.pop();}else{parts.push(format);format=null;}}
parts.forEach(function(value){var dateGetterParameter=DATE_FORMATS[value];if(dateGetterParameter){text+=dateGetter.apply(this,dateGetterParameter)(date)}else{text+=value;}});return text;};Calendar.getDateFromFormattedString=function(str,format){var date=getEpochOfCST();var match;var parts=[];var strParts=[];var fn;while(format){match=DATE_FORMATS_SPLIT.exec(format);if(match){parts=parts.concat(match.slice(1));format=parts.pop();var matchSize=(match[1].length);var leftStr=str.substr(0,matchSize);str=str.substr(matchSize);strParts.push(leftStr);}else{parts.push(format);strParts.push(str);}}
for(var i=0;i<parts.length;i++){var part=parts[i];var strPart=strParts[i];if(strPart==""){break}
var number=parseInt(strPart,10);var dateSetterParameter=DATE_FORMATS[part];if(dateSetterParameter){fn=dateSetter.apply(this,dateSetterParameter);if(!isNaN(number)){fn(date,number);}}}
if(+date===+getEpochOfCST()){date=new Date();date.isInvalidDate=true;}
return date;};Calendar.getDaysBetween=function(start,end){return Math.abs(start-end)/60/60/1000/24;};Calendar.getFirstDateInMonth=function(date){return new Date(date.getFullYear,date.getMonth(),1);};Calendar.getLastDateInMonth=function(date){return new Date(date.getFullYear,date.getMonth()+1,0);};Calendar.getDaysInMonth=function(month,fullYear){if(month===1&&fullYear!==undefined&&Calendar.isLeapYear(fullYear)){return 29;}
return monthSize[month];};Calendar.monthOffset=function(date,monthOffset){var newDate=new Date(date);newDate.setMonth(newDate.getMonth()+monthOffset);return newDate;};Calendar.yearOffset=function(date,yearOffset){var newDate=new Date(date);newDate.setFullYear(newDate.getFullYear()+yearOffset);return newDate;};Calendar.dateOffset=function(date,dayOffset){var newDate=new Date(date);newDate.setDate(newDate.getDate()+dayOffset);return newDate;};Calendar.dateToDay=function(date){return new Date(date.getFullYear(),date.getMonth(),date.getDate());};Calendar.dayToMS=function(days){return days*1000*60*60*24;};var n=0;Calendar.prototype={version:"1.0.0.0",construction:Calendar,destruction:function(){this.unLoadCal();},initLimit:function(){var maxLimit=this.options.maxLimit;var minLimit=this.options.minLimit;if(maxLimit){this.maxLimitDate=Calendar.getDateFromFormattedString(maxLimit,this.options.dateFormat);}
if(minLimit){this.minLimitDate=Calendar.getDateFromFormattedString(minLimit,this.options.dateFormat);}},init:function(options){var template;if(options.template=="birthday"){this.isBirthday=true;}
if(typeof options.template=="object"){template=smallTemplate;for(var temp in options.template){template[temp]=options.template[temp];}}else{switch(options.template){case"big":template=bigTemplate;break;case"birthday":template=birthdayTemplate;break;case"small":template=smallTemplate;break;default:template=smallTemplate;break;}}
options.template=template;if(options.isBirthday&&Factory.defaults.titleTip==options.titleTip){options.titleTip='<span class="cal-year-select">{{year}}年<i></i></span><span class="cal-month-select">{{month}}月<i></i></span>';}
this.options=options;this.defaults=Factory.defaults;this.wrap=this.wrap||this.initWrap();this.date=new Date();this.selected={};this.selectedTime=getEpochOfCST();this.cascadingSelected={start:null,end:null,startTime:getEpochOfCST(),endTime:getEpochOfCST()};this.cascadingIndex=0;this.id=n++;this.initLimit();this.initNow();this.loadCal();},initNow:function(){var dateStr=this.options.date;if(typeof dateStr=="string"&&dateStr!==""){this.now=Calendar.getDateFromFormattedString(dateStr,this.options.dateFormat);}else{this.now=new Date()}},initWrap:function(){var html=$.trim(this.options.template.wrap);html=this.replaceWith(html,{bimonthly:'data-bimonthly="'+this.options.bimonthly+'"',float:'data-float="'+!this.options.autoRender+'"'});return $(html);},loadCal:function(){var options=this.options;if(options.autoRender){this.render();this.bindEvent();$(options.trigger).append(this.wrap)}else{$(document).off(options.triggerEvent,options.trigger,this.triggerEventHandler);$(document).on(options.triggerEvent,options.trigger,{self:this},this.triggerEventHandler);this.triggerBlur();}},unLoadCal:function(){var options=this.options;$(document).off(options.triggerEvent,options.trigger,this.triggerEventHandler);this.unBindEvent();},triggerBlur:function(){var self=this;$document.on("click",{self:self},this.destroyHandler);},destroy:function(){this.wrap.remove();$(".calhover").remove();$(".cal-number-of-days").remove();},destroyHandler:function(e){var $target=$(e.target);var self=e.data.self;var $calendar=$target.parents(".ui-calendar");var options=self.options;if($calendar.length<=0&&options.clickDocumentHide==true){self.destroy();}},triggerEventHandler:function(e){var self=e.data.self;e.stopPropagation();var $this=$(this);var date;if(self.options.cascading){var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var $triggers=$(self.options.trigger);var $triggerFirst=$triggers.first();var triggerFirstValue=$triggerFirst.val();var $triggerLast=$triggers.last();var triggerLastValue=$triggerLast.val();if(!start){if(triggerFirstValue){start=triggerFirstValue;self.cascadingSelected.start=start}}
if(!end){if(triggerLastValue){end=triggerLastValue;self.cascadingSelected.end=end}}
var index=$triggers.index($this);if(index==0){if(start){date=Calendar.getDateFromFormattedString(start,self.options.dateFormat);}}else if(index==1){if(end){date=Calendar.getDateFromFormattedString(end,self.options.dateFormat);}}
if(date){self.now=date;}}else{var value=$this.val();if(value){date=Calendar.getDateFromFormattedString(value,self.options.dateFormat);self.selected={};self.selected[value]=true;self.now=date;}}
if($this.is("[readonly]")&&!self.options.renderReadonly){return false;}
self.$trigger=$this;var offset=self.getOffset();self.wrap.css({"top":offset.top,"left":offset.left});var zIndex=self.options.zIndex;if(zIndex){self.wrap.css("z-index",zIndex);}
var $target=$(self.options.target);$('.ui-calendar[data-float=true]').remove();$target.append(self.wrap);self.render();self.bindEvent();},getOffset:function(){var $trigger=this.$trigger;var offsetAmount=this.options.offsetAmount;var top=this.getInt($trigger.offset().top+$trigger.outerHeight(false)+offsetAmount.top);var left=this.getInt($trigger.offset().left+offsetAmount.left);return{top:top,left:left};},getInt:function(floatNumber){var intNumber=parseInt(floatNumber,10);return intNumber;},bindEvent:function(){this.bindMonthChangeEvent();this.bindSelectEvent();this.bindMouseOverEvent();this.bindMouseLeaveEvent();this.bindBirthdayEvent();},bindBirthdayEvent:function(){this.wrap.off("click",this.hideDropdownHandler);this.wrap.on("click",{self:this},this.hideDropdownHandler);this.wrap.off("click",".cal-year-select",this.yearDropdownHandler);this.wrap.on("click",".cal-year-select",{self:this},this.yearDropdownHandler);this.wrap.off("click",".cal-month-select",this.monthDropdownHandler);this.wrap.on("click",".cal-month-select",{self:this},this.monthDropdownHandler);this.wrap.off("click",".cal-year-dropdown li",this.yearSelectHandler);this.wrap.on("click",".cal-year-dropdown li",{self:this},this.yearSelectHandler);this.wrap.off("click",".cal-month-dropdown li",this.monthSelectHandler);this.wrap.on("click",".cal-month-dropdown li",{self:this},this.monthSelectHandler);this.wrap.off("click",".cal-birthday-clear",this.birthdayClearHandler);this.wrap.on("click",".cal-birthday-clear",{self:this},this.birthdayClearHandler);this.wrap.off("click",".cal-birthday-ok",this.birthdayOkHandler);this.wrap.on("click",".cal-birthday-ok",{self:this},this.birthdayOkHandler);this.wrap.off("click",".cal-hour",this.birthdayHourHandler);this.wrap.on("click",".cal-hour",{self:this},this.birthdayHourHandler);this.wrap.off("click",".cal-minute",this.birthdayMinuteHandler);this.wrap.on("click",".cal-minute",{self:this},this.birthdayMinuteHandler);this.wrap.off("click",".cal-hour-dropdown li",this.hourSelectHandler);this.wrap.on("click",".cal-hour-dropdown li",{self:this},this.hourSelectHandler);this.wrap.off("click",".cal-minute-dropdown li",this.minuteSelectHandler);this.wrap.on("click",".cal-minute-dropdown li",{self:this},this.minuteSelectHandler);this.wrap.off("click",".cal-minute-dropdown .close",this.minuteCloseHandler);this.wrap.on("click",".cal-minute-dropdown .close",{self:this},this.minuteCloseHandler);this.wrap.off("click",".cal-hour-dropdown .close",this.hourCloseHandler);this.wrap.on("click",".cal-hour-dropdown .close",{self:this},this.hourCloseHandler);},hourCloseHandler:function(e){e.stopPropagation();var self=e.data.self;var $hourDropdown=self.wrap.find(".cal-hour-dropdown");$hourDropdown.remove();self.wrap.find(".cal-hour").removeClass("active");},minuteCloseHandler:function(e){e.stopPropagation();var self=e.data.self;var $minuteDropdown=self.wrap.find(".cal-minute-dropdown");$minuteDropdown.remove();self.wrap.find(".cal-minute").removeClass("active");},validateTime:function(){var cascadingSelected=this.cascadingSelected;if(cascadingSelected.start&&(cascadingSelected.start==cascadingSelected.end)){var startTime=cascadingSelected.startTime;var endTime=cascadingSelected.endTime;var lastTime=getEpochOfCST();lastTime.setHours(23);lastTime.setMinutes(55);if(+startTime==+lastTime){this.cascadingSelected.end=null;this.cascadingSelected.endTime=getEpochOfCST();}else if(startTime>=endTime){startTime=new Date(startTime.getTime()+fiveMinutes);this.cascadingSelected.endTime.setTime(startTime);}}},hourSelectHandler:function(e){e.stopPropagation();var self=e.data.self;var $this=$(this);if($this.is('[data-disabled="true"]')){return false;}
var hourStr=$this.attr("data-hour");var hour=parseInt(hourStr,10);var $calHour=self.wrap.find(".cal-hour");if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.startTime.setHours(hour);}else{self.cascadingSelected.endTime.setHours(hour);}
self.validateTime();}else{self.selectedTime.setHours(hour);}
var $hourDropdown=self.wrap.find(".cal-hour-dropdown");$hourDropdown.remove();$calHour.html(hourStr).removeClass("active");},minuteSelectHandler:function(e){e.stopPropagation();var self=e.data.self;var $this=$(this);if($this.is('[data-disabled="true"]')){return false;}
var minuteStr=$this.attr("data-minute");var $calMinute=self.wrap.find(".cal-minute");var minute=parseInt(minuteStr,10);if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.startTime.setMinutes(minute);}else{self.cascadingSelected.endTime.setMinutes(minute);}
self.validateTime();}else{self.selectedTime.setMinutes(minute);}
var $minuteDropdown=self.wrap.find(".cal-minute-dropdown");$minuteDropdown.remove();$calMinute.html(minuteStr).removeClass("active");},birthdayHourHandler:function(e){var self=e.data.self;var $this=$(this);var val=$this.html();$this.addClass("active");self.wrap.find(".cal-hour-dropdown").remove();self.wrap.find(".cal-minute-dropdown").remove();var $hourDropdown=$(''+'<div class="cal-hour-dropdown">'+'<div class="title">小时<div class="close"><i></i></div></div>'+'</div>');var $ul=$("<ul></ul>");var liArr=[];var activeClass;var startHour=0;var disabled;if(self.options.cascading&&self.cascadingIndex===1){var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var startTime=self.cascadingSelected.startTime;if(start&&(start==end)){startHour=startTime.getHours();}}
for(var i=0;i<24;i+=1){var dataHour=padNumber(i,2);if(dataHour==val){activeClass=true;}else{activeClass=false;}
if(i<startHour){disabled=true;}else{disabled=false;}
liArr.push(''+'<li'+' class="'+(activeClass?'active':'')+'"'+' data-disabled="'+(disabled?'true':'false')+'"'+' data-hour="'+dataHour+'">'+
i+'</li>');}
var liStr=liArr.join("");$ul.html(liStr);$hourDropdown.append($ul);self.wrap.append($hourDropdown);},birthdayMinuteHandler:function(e){var $this=$(this);var self=e.data.self;$this.addClass("active");var val=$this.html();var startMinute=0;var disabled;var sameDayAndHour=false;self.wrap.find(".cal-hour-dropdown").remove();self.wrap.find(".cal-minute-dropdown").remove();if(self.options.cascading&&self.cascadingIndex===1){var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var startTime=self.cascadingSelected.startTime;var endTime=self.cascadingSelected.endTime;if(start&&(start==end)){var startHour=startTime.getHours();var endHour=endTime.getHours();if(startHour===endHour){sameDayAndHour=true;startMinute=startTime.getMinutes();}}}
var $minuteDropdown=$(''+'<div class="cal-minute-dropdown">'+'<div class="title">分钟<div class="close"><i></i></div></div>'+'</div>');var $ul=$("<ul></ul>");var liArr=[];var activeClass;for(var i=0;i<60;i+=5){var dataMinute=padNumber(i,2);if(dataMinute==val){activeClass=true;}else{activeClass=false;}
if(sameDayAndHour&&(i<startMinute+5)){disabled=true;}else{disabled=false;}
liArr.push(''+'<li class="'+(activeClass?'active':'')+'"'+' data-disabled="'+(disabled?'true':'false')+'"'+' data-minute="'+dataMinute+'">'+i+'</li>');}
var liStr=liArr.join("");$ul.html(liStr);$minuteDropdown.append($ul);self.wrap.append($minuteDropdown);},birthdayOkHandler:function(e){e.stopPropagation();var self=e.data.self;self.inputTime();self.destroy();var okCallback=self.options.okCallback;if(okCallback&&$.isFunction(okCallback)){okCallback.call(self,self);}
self.toNextCal();},inputTime:function(){var self=this;var date;var start=self.cascadingSelected.start;var end=self.cascadingSelected.end;var result;if(self.options.cascading){if((self.cascadingIndex===0)&&start){date=Calendar.getDateFromFormattedString(start,self.options.dateFormat);result=self.getDateResult(date);}else if(end){date=Calendar.getDateFromFormattedString(end,self.options.dateFormat);result=self.getDateResult(date);}
if(result){self.$trigger.val(result);}}},birthdayClearHandler:function(e){var self=e.data.self;self.$trigger.val("");if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.start=null;self.cascadingSelected.startTime=getEpochOfCST();}else{self.cascadingSelected.end=null;self.cascadingSelected.endTime=getEpochOfCST();}}else{self.selected={};self.selectedTime=getEpochOfCST();}
self.destroy();var clearCallback=self.options.clearCallback;if(clearCallback&&$.isFunction(clearCallback)){clearCallback.call(self,self);}
e.stopPropagation();},monthSelectHandler:function(e){var self=e.data.self;var $this=$(this);var selectedMonth=$this.attr("data-month");var month=parseInt(selectedMonth,10);self.now.setDate(1);self.now.setMonth(month);self.render();self.bindEvent();e.stopPropagation();},limitDropdown:function(){var minLimitDate=this.minLimitDate;var maxLimitDate=this.maxLimitDate;var now=this.now;var nowYear=now.getFullYear();var nowMonth=now.getMonth();if(minLimitDate&&nowYear==minLimitDate.getFullYear()){var minMonth=minLimitDate.getMonth();if(nowMonth<minMonth){this.now.setDate(1);this.now.setMonth(minMonth)}}
if(maxLimitDate&&nowYear==maxLimitDate.getFullYear()){var maxMonth=maxLimitDate.getMonth();if(nowMonth>maxMonth){this.now.setDate(1);this.now.setMonth(maxMonth)}}},yearSelectHandler:function(e){var self=e.data.self;var $this=$(this);var selectedYear=$this.attr("data-year");var year=parseInt(selectedYear,10);self.now.setFullYear(year);self.limitDropdown();self.render();self.bindEvent();e.stopPropagation();},hideDropdownHandler:function(e){var self=e.data.self;var $target=$(e.target);var $yearDropdown=self.wrap.find(".cal-year-dropdown-box");var $monthDropdown=self.wrap.find(".cal-month-dropdown-box");var $hourDropdown=self.wrap.find(".cal-hour-dropdown");var $minuteDropdown=self.wrap.find(".cal-minute-dropdown");var $hour=self.wrap.find(".cal-hour");var $minute=self.wrap.find(".cal-minute");$yearDropdown.hide();$monthDropdown.hide();$hourDropdown.hide();$minuteDropdown.hide();$hour.removeClass("active");$minute.removeClass("active");if($target.is(".cal-year-select")||$target.parents(".cal-year-select").length>0){$yearDropdown.show();}
if($target.is(".cal-month-select")||$target.parents(".cal-month-select").length>0){$monthDropdown.show();}
if($target.is(".cal-hour")||$target.is(".cal-hour-dropdown")||$target.parents(".cal-hour-dropdown").length>0){$hourDropdown.show();$hour.addClass("active");}
if($target.is(".cal-minute")||$target.is(".cal-minute-dropdown")||$target.parents(".cal-minute-dropdown").length>0){$minuteDropdown.show();$minute.addClass("active");}},yearDropdownHandler:function(e){var self=e.data.self;var $this=$(this);var $yearDropdown=self.wrap.find(".cal-year-dropdown-box");if($yearDropdown.length<=0){$yearDropdown=self.createYearDropdown($this);}
if($this.hasClass("active")){$yearDropdown.hide();}else{$yearDropdown.show();}
var calOffset={top:self.wrap.offset().top,left:self.wrap.offset().left};var offset={top:$this.offset().top,left:$this.offset().left};var calDate=self.now;var calYear=calDate.getFullYear();var $yearCurrentLi=$yearDropdown.find("[data-year="+calYear+"]");$yearDropdown.css({top:offset.top-calOffset.top,left:offset.left-calOffset.left});self.wrap.append($yearDropdown);$yearCurrentLi.addClass("active");var currentLiHeight=$yearCurrentLi.outerHeight();var currentLiIndex=$yearCurrentLi.index();var currentLiTop=currentLiHeight*currentLiIndex;$yearDropdown.find(".cal-year-dropdown").scrollTop(currentLiTop)},monthDropdownHandler:function(e){var self=e.data.self;var $this=$(this);var $monthDropdown=self.wrap.find(".cal-month-dropdown-box");if($monthDropdown.length<=0){$monthDropdown=self.createMonthDropdown($this);}
if($this.hasClass("active")){$monthDropdown.hide();}else{$monthDropdown.show();}
var calOffset={top:self.wrap.offset().top,left:self.wrap.offset().left};var offset={top:$this.offset().top,left:$this.offset().left};var calDate=self.now;var calMonth=calDate.getMonth();var $yearCurrentLi=$monthDropdown.find("[data-month="+calMonth+"]");$monthDropdown.css({top:offset.top-calOffset.top,left:offset.left-calOffset.left});self.wrap.append($monthDropdown);$yearCurrentLi.addClass("active");var currentLiHeight=$yearCurrentLi.outerHeight();var currentLiIndex=$yearCurrentLi.index();var currentLiTop=currentLiHeight*currentLiIndex;$monthDropdown.scrollTop(currentLiTop)},createMonthDropdown:function(){var minLimitDate=this.minLimitDate;var maxLimitDate=this.maxLimitDate;var minYear=minLimitDate?minLimitDate.getFullYear():1900;var maxYear=maxLimitDate?maxLimitDate.getFullYear():2099;var minMonth=0;var maxMonth=11;var nowYear=this.now.getFullYear();if(nowYear==minYear&&minLimitDate){minMonth=minLimitDate.getMonth();}
if(nowYear==maxYear&&maxLimitDate){maxMonth=maxLimitDate.getMonth();}
var $dropdownBox=$(''+'<div class="cal-month-dropdown-box">'+'    <div class="cal-month-select-active">'+(this.now.getMonth()+1)+'月<i></i></div>'+'</div>');var $ul=$('<ul class="cal-month-dropdown"></ul>');$dropdownBox.append($ul);var liStr=[];for(var index=minMonth;index<=maxMonth;index++){liStr.push('<li data-month="'+index+'">'+(index+1)+'</li>');}
$ul.html(liStr.join(""));return $dropdownBox;},createYearDropdown:function(){var minLimitDate=this.minLimitDate;var maxLimitDate=this.maxLimitDate;var minYear=minLimitDate?minLimitDate.getFullYear():1900;var maxYear=maxLimitDate?maxLimitDate.getFullYear():2099;var $dropdownBox=$(''+'<div class="cal-year-dropdown-box">'+'    <div class="cal-year-select-active">'+this.now.getFullYear()+'年<i></i></div>'+'</div>');var $ul=$('<ul class="cal-year-dropdown"></ul>');$dropdownBox.append($ul);var liStr=[];for(var i=minYear;i<=maxYear;i++){liStr.push('<li data-year="'+i+'">'+i+'</li>');}
$ul.html(liStr.join(""));return $dropdownBox;},bindMouseOverEvent:function(){this.wrap.off("mouseenter","[data-date-map]",this.bindMouseOverHandler);this.wrap.on("mouseenter","[data-date-map]",{self:this},this.bindMouseOverHandler);},bindMouseLeaveEvent:function(){this.wrap.off("mouseleave","[data-date-map]",this.bindMouseLeaveHandler);this.wrap.on("mouseleave","[data-date-map]",{self:this},this.bindMouseLeaveHandler);},bindMouseLeaveHandler:function(e){var self=e.data.self;if(self.options.cascading){self.hideNumberOfDays();self.renderSelected(false,false);}
if(self.options.sectionSelect){self.renderSelected(false,false);}},bindMouseOverHandler:function(e){var self=e.data.self;var $this=$(this);var dateStr=$this.attr("data-date-map");if(self.options.cascading){if(!$this.children().is(".nodate,.caldisabled")){if(!self.options.cascadingEndNotShowStart){self.renderSelected(dateStr,false);}}}
if(self.options.sectionSelect&&self.sectionSelectFlag){if(!$this.children().is(".notThisMonth,.nodate")){self.renderSelected(dateStr,false);}}},bindSelectEvent:function(){this.wrap.off("click","[data-date-map]",this.bindSelectHandler);this.wrap.on("click","[data-date-map]",{self:this},this.bindSelectHandler);},getDateResult:function(dateVal){var self=this;if(self.options.cascading){if(self.cascadingIndex===0){var startTime=self.cascadingSelected.startTime;dateVal.setHours(startTime.getHours());dateVal.setMinutes(startTime.getMinutes());}else{var endTime=self.cascadingSelected.endTime;dateVal.setHours(endTime.getHours());dateVal.setMinutes(endTime.getMinutes());}}else{var time=self.selectedTime;dateVal.setHours(time.getHours());dateVal.setMinutes(time.getMinutes());}
var dateResult=Calendar.dateFormat(dateVal,self.options.dateFormat);return dateResult;},canSectionSelect:function(td,self,date){var hasProductStr=td.attr("data-has-product");var hasProduct=false;if(hasProductStr=="true"){hasProduct=true;}
var canSelect=0;if(!self.sectionSelectFlag){if(hasProduct){self.sectionSelectFlag=true;self.sectionSelectEnd=null;self.sectionSelectStart=date;self.sectionSelectEnd=Calendar.dateOffset(date,1)}}else{var middle;var sectionSelectStart;var sectionSelectEnd;var middleStr;if(+self.sectionSelectStart==+date){}else{if(self.sectionSelectStart>date){if(hasProduct){return 4;}else{return 3;}}else{sectionSelectStart=self.sectionSelectStart;sectionSelectEnd=date;}
canSelect=1;middle=Calendar.dateOffset(sectionSelectStart,1);while(middle<sectionSelectEnd){middleStr=Calendar.dateFormat(middle,self.options.dateFormat);var $middle=self.wrap.find('[data-date-map='+middleStr+']');if($middle.attr("data-has-product")!=="true"){canSelect=2;break;}
middle=Calendar.dateOffset(middle,1);}}}
return canSelect;},bindSelectHandler:function(e){e.stopPropagation();var self=e.data.self;var selectDateCallback=self.options.selectDateCallback;var cancelDateCallback=self.options.cancelDateCallback;var autoRender=self.options.autoRender;var $this=$(this);function runSelectDateCallback(){if(selectDateCallback){selectDateCallback.call(self,self,$this);}}
function runCancelDateCallback(){if(cancelDateCallback){cancelDateCallback.call(self,self,$this);}}
if($this.children().first().is(".nodate,.caldisabled")){}else if($this.children().is(".notThisMonth")&&self.options.bimonthly){}else{var dateStr=$this.attr("data-date-map");var format=self.options.dateFormat;if(dateStr){var date=Calendar.getDateFromFormattedString(dateStr,format);if(!self.options.sectionSelect){self.now=new Date(date);}}
var end=self.cascadingSelected.end;if(end){var endDate=Calendar.getDateFromFormattedString(end,format);}
if(self.options.cascading){}else if(self.options.sectionSelect){var canSelect=self.canSectionSelect($this,self,date);if(canSelect==1||canSelect==2){self.sectionSelectFlag=false;self.sectionSelectEnd=date;}
if(canSelect==1||canSelect==0||canSelect==4){runSelectDateCallback()}else{runCancelDateCallback()}
if(canSelect==4){self.sectionSelectFlag=true;self.sectionSelectStart=date
self.sectionSelectEnd=Calendar.dateOffset(date,1);}
self.renderSelected();self.bindEvent();}else{var hasInventory=$this.children().hasClass("hasInventory");if(self.options.allowMutiSelected){var isSelect=$this.is(".td-selected");if(isSelect){delete self.selected[dateStr];$this.removeClass("td-selected");if(autoRender){runCancelDateCallback();}}else{self.selected[dateStr]=true;$this.addClass("td-selected");if(autoRender){runSelectDateCallback();}}}else{self.selected={};self.selected[dateStr]=true;var $date=self.wrap.find("[data-date-map]");$date.removeClass("td-selected");$this.addClass("td-selected");if(autoRender){runSelectDateCallback();}}}}
if(!autoRender){var $td=$this;if($this.find(".nodate,.caldisabled").length>0){return false;}
if($this.children().is(".notThisMonth")&&self.options.bimonthly){return false;}
var dateMap=$td.attr("data-date-map");var dateVal=Calendar.getDateFromFormattedString(dateMap,self.options.dateFormat);var dateResult=self.getDateResult(dateVal);self.$trigger.val(dateResult);runSelectDateCallback();if(self.options.cascading){if(self.cascadingIndex===0){self.cascadingSelected.start=dateMap}else{self.cascadingSelected.end=dateMap}
if(self.cascadingIndex===0&&end&&dateStr){var max=self.options.cascadingMax;var min=self.options.cascadingMin;var offset=self.options.cascadingOffset;var dayNext=self.options.dayNext;var thisDate=Calendar.dateToDay(self.date);var newEndDate;var maxDate=new Date(+date+Calendar.dayToMS(max));if(maxDate<endDate&&max!=-1){newEndDate=Calendar.dateFormat(maxDate,format);self.cascadingSelected.end=newEndDate;}
var offsetDate=new Date(+date+Calendar.dayToMS(offset));if(offsetDate>endDate){newEndDate=Calendar.dateFormat(offsetDate,format);self.cascadingSelected.end=newEndDate;}
if(dayNext!=-1){var lastDate=Calendar.dateOffset(thisDate,dayNext);if(offsetDate&&(+offsetDate>+lastDate)){newEndDate=Calendar.dateFormat(lastDate,format);self.cascadingSelected.end=newEndDate;}}}
self.validateTime();if(!self.options.hasTime){self.destroy();self.toNextCal();}else{self.dateValidate();self.render();self.bindEvent();}}else{self.destroy();}}},unBindEvent:function(){this.unBindMonthChangeEvent();},bindMonthChangeEvent:function(){var monthChangeOffset=this.options.monthChangeOffset||1;var $monthPrev=this.wrap.find(".month-prev");var $monthNext=this.wrap.find(".month-next");$monthPrev.off("click",this.monthChangeHandler);$monthPrev.on("click",{self:this,monthOffset:-monthChangeOffset},this.monthChangeHandler);$monthNext.off("click",this.monthChangeHandler);$monthNext.on("click",{self:this,monthOffset:+monthChangeOffset},this.monthChangeHandler);},unBindMonthChangeEvent:function(){var $monthPrev=this.wrap.find(".month-prev");var $monthNext=this.wrap.find(".month-next");$monthPrev.off("click",this.monthChangeHandler);$monthNext.off("click",this.monthChangeHandler);},dateValidate:function(){var $triggers=$(this.options.trigger);var end=this.cascadingSelected.end;if(end){var endDate=Calendar.getDateFromFormattedString(end,this.options.dateFormat);var endTime=this.cascadingSelected.endTime;endDate.setHours(endTime.getHours());endDate.setMinutes(endTime.getMinutes());var endDateStr=Calendar.dateFormat(endDate,this.options.dateFormat);$triggers.eq(1).val(endDateStr);}else{$triggers.eq(1).val("");}},toNextCal:function(){var $triggers=$(this.options.trigger);var triggerSize=$triggers.length;var cascadingCallback=this.options.cascadingCallback;this.dateValidate();if(this.options.cascadingNextAuto){var index=$triggers.index(this.$trigger);if(triggerSize-1==index){}else{var eventName=this.options.triggerEvent;$triggers.eq(index+1).trigger(eventName);if(cascadingCallback){cascadingCallback.call(this,this,$triggers.eq(index+1));}}}},monthLimit:function(){var mosNext=this.options.monthNext;var mosPrev=this.options.monthPrev;var upperLimit=Calendar.monthOffset(today,mosNext);var lowerLimit=Calendar.monthOffset(today,-mosPrev);if(mosNext!=-1&&Calendar.isSameMonth(upperLimit,this.now)){this.hideMonthNext();}
if(mosPrev!=-1&&Calendar.isSameMonth(lowerLimit,this.now)){this.hideMonthPrev();}},DateLimit:function(){if(this.maxLimitDate){var isSameMonthNext=Calendar.isSameMonth(this.maxLimitDate,this.now);if(isSameMonthNext){this.hideMonthNext();}}
if(this.minLimitDate){var isSameMonthPrev=Calendar.isSameMonth(this.minLimitDate,this.now);if(isSameMonthPrev){this.hideMonthPrev();}}},hideMonthNext:function(){this.wrap.find(".month-next").hide();},hideMonthPrev:function(){this.wrap.find(".month-prev").hide();},showMonthNext:function(){this.wrap.find(".month-next").show();},showMonthPrev:function(){this.wrap.find(".month-prev").show();},monthChangeHandler:function(e){var self=e.data.self;var monthOffset=e.data.monthOffset;self.now.setDate(1);self.now=Calendar.monthOffset(self.now,monthOffset);self.render();self.bindEvent();e.stopPropagation();},toMonth:function(yearStr,monthStr){var year=parseInt(yearStr,10);var month=parseInt(monthStr,10)-1;if(typeof year==="number"){this.now.setFullYear(year);}
if(typeof month==="number"){this.now.setDate(1);this.now.setMonth(month);}
this.render();this.bindEvent();},hideNumberOfDays:function(){$(".cal-number-of-days").hide();},render:function(disableCallback){var self=this;if(this.options.cascading){var $trigger=self.$trigger;var $triggers=$(self.options.trigger);this.cascadingIndex=$triggers.index($trigger);}
this.hideNumberOfDays();this.wrap.html("");this.wrap.append(this.createHead());this.wrap.append(this.createBody());if(this.wrap.is(".ui-calendar-big")&&this.options.showPriceTip){this.wrap.append("<div class='nova-calendar-tip'><i></i>"+this.options.priceTipText+"</div>")}
var sourceFn=this.options.sourceFn;if(!disableCallback&&$.isFunction(sourceFn)){sourceFn.call(self,self);}
this.wrap.addClass(this.options.wrapClass);var completeCallback=this.options.completeCallback;this.renderFestival();this.renderSelected(false,true);this.renderTime();this.monthLimit();this.DateLimit();if(!disableCallback&&$.isFunction(completeCallback)){completeCallback.call(this,this);}},renderTime:function(){if(this.options.hasTime){this.wrap.find(".cal-pane").children().css({"display":"inline-block"});}
if(this.options.cascading){this.renderCascadingTime();}else{this.renderNormalTime();}},setTimeHtml:function(time){var hour=time.getHours();var minute=time.getMinutes();var hourStr=padNumber(hour,2);var minuteStr=padNumber(minute,2);var $hour=this.wrap.find(".cal-hour");var $minute=this.wrap.find(".cal-minute");$hour.html(hourStr);$minute.html(minuteStr);},renderNormalTime:function(){this.setTimeHtml(this.selectedTime);},renderCascadingTime:function(){var startTime=this.cascadingSelected.startTime;var endTime=this.cascadingSelected.endTime;if(this.cascadingIndex===0){this.setTimeHtml(startTime);}else if(this.cascadingIndex===1){this.setTimeHtml(endTime);}},renderSelected:function(mouseOverEnd,isClick){var self=this;var selected=this.selected;var $dates=this.wrap.find("[data-date-map]").has(".caldate");var cascadingMin=this.options.cascadingMin;var cascadingMax=self.options.cascadingMax;var cascadingEndNotShowStart=self.options.cascadingEndNotShowStart;$dates.children().removeClass("calmiddle");var dateFormat=self.options.dateFormat;if(self.options.cascading){var start=self.cascadingSelected.start;var end=mouseOverEnd||self.cascadingSelected.end;var $startDate=$dates.filter('[data-date-map="'+start+'"]').has(".caldate");var $endDate=$dates.filter('[data-date-map="'+end+'"]').has(".caldate");if(start){var startDate=Calendar.getDateFromFormattedString(start,dateFormat);}
if(end){var endDate=Calendar.getDateFromFormattedString(end,dateFormat);}
if(this.cascadingIndex===0){}else{if(start){$dates.each(function(index,domEle){var $date=$(domEle);var dateStr=$date.attr("data-date-map");var date=Calendar.getDateFromFormattedString(dateStr,self.options.dateFormat);if(end){if(date>startDate&&date<endDate){if(!self.options.cascadingEndNotShowStart){$date.children().addClass("calmiddle");}}}
if(cascadingMin!=-1){if(date<+startDate+Calendar.dayToMS(cascadingMin)){$date.children().addClass("caldisabled")}}
if(cascadingMax!=-1){if(date>+startDate+Calendar.dayToMS(cascadingMax)){$date.children().addClass("caldisabled");}}});if(end&&$endDate.length>0){var numberOfDays=Calendar.getDaysBetween(startDate,endDate);var size={width:$endDate.width(),height:$endDate.height(),left:$endDate.offset().left,top:$endDate.offset().top};var $numberOfDays=$(".cal-number-of-days");if($numberOfDays.length<=0){$numberOfDays=$(''+'<div class="cal-number-of-days">'+'    <div class="triangle"></div>'+'    <span></span>'+'</div>');}
$numberOfDays.css({left:0,top:0});var $numberOfDaysSpan=$numberOfDays.children("span");var template=self.options.numberOfDays;var numberOfDaysHtml=self.replaceWith(template,{num:numberOfDays});$numberOfDaysSpan.html(numberOfDaysHtml);$body.append($numberOfDays);var width=$numberOfDays.width();$numberOfDays.css({left:size.left-~~(width-size.width/2)+2,top:size.top+size.height+7});if(self.options.zIndex){$numberOfDays.css("zIndex",self.options.zIndex+1);}
if(self.options.showNumberOfDays){$numberOfDays.show();}}}
if(end){if(!mouseOverEnd){$endDate.addClass("td-selected");}}}
if(end&&mouseOverEnd&&!self.options.hasTime){$dates.removeClass("td-selected");}
if(start&&!((cascadingEndNotShowStart&&this.cascadingIndex===1))){$startDate.addClass("td-selected")}}
if(self.options.sectionSelect){var $wrap=self.wrap;var $tds=$wrap.find("td[data-date-map]").filter(function(index,ele){var $ele=$(ele);if($ele.find(".notThisMonth").length>0){return false}else{return true;}});$tds.removeClass("td-selected").children().removeClass("calmiddle").find(".calday").each(function(index,ele){var $ele=$(ele);var backup=$ele.attr("data-backup");if(backup){$ele.text(backup);}});var sectionSelectStart=self.sectionSelectStart;var sectionSelectEnd=self.sectionSelectEnd;if(mouseOverEnd){sectionSelectEnd=Calendar.getDateFromFormattedString(mouseOverEnd,self.options.dateFormat);}
if(+sectionSelectStart==+sectionSelectEnd){return;}
if(sectionSelectStart&&sectionSelectEnd){if(+sectionSelectStart>+sectionSelectEnd){sectionSelectStart=null;sectionSelectEnd=null;if(!mouseOverEnd){self.sectionSelectStart=sectionSelectStart;self.sectionSelectEnd=sectionSelectEnd;}}
var middle=Calendar.dateOffset(sectionSelectStart,1);var $middle;var middleStr;while(+middle<+sectionSelectEnd){middleStr=Calendar.dateFormat(middle,dateFormat);$middle=$tds.filter('td[data-date-map='+middleStr+']');$middle.children().addClass("calmiddle");middle=Calendar.dateOffset(middle,1);}}
if(sectionSelectStart){var sectionSelectStartStr=Calendar.dateFormat(sectionSelectStart,dateFormat);var $start=$tds.filter('td[data-date-map='+sectionSelectStartStr+']');$start.addClass("td-selected");var $startCalDay=$start.find(".calday");$startCalDay.attr("data-backup",$startCalDay.text()).text("入住");}
if(sectionSelectEnd){var sectionSelectEndStr=Calendar.dateFormat(sectionSelectEnd,dateFormat);var $end=$tds.filter('td[data-date-map='+sectionSelectEndStr+']');$end.addClass("td-selected");var $endCalDay=$end.find(".calday");$endCalDay.attr("data-backup",$endCalDay.text()).text("退房");}}
$dates.each(function(index,domEle){var $td=$(domEle);if(!$td.find(".nodate").length>0){var date=$td.attr("data-date-map");if(self.selected[date]){if(self.options.autoRender){$td.addClass("td-selected");}else{if(self.$trigger.val()!=""){$td.addClass("td-selected");}}
var $thisTd=self.wrap.find('[data-date-map="'+date+'"]');if($thisTd.length>1){$thisTd.has(".notThisMonth").removeClass("td-selected");}}}});},renderFestival:function(){var festival=this.options.festival;var self=this;var $tds=this.wrap.find('td[data-date-map]');var dateToday=new Date(self.date.getFullYear(),self.date.getMonth(),self.date.getDate());var dateTodayStr=Calendar.dateFormat(dateToday,self.options.dateFormat);$tds.each(function(i,domEle){var $td=$(domEle);var $date=$td.find(".caldate");var $calActive=$date.find(".calactive");var $calday=$date.find(".calday");var date=$td.attr("data-date-map");var tdFestival=festival[date];if(tdFestival){if($(self.wrap).is(".ui-calendar-mini")){if(tdFestival.name){$date.html(tdFestival.name);$date.addClass("festival");}}else{var $calFestival=$('<div class="calfestival">休</div>');$calActive.append($calFestival);if(tdFestival.name){$date.addClass("festival");$calday.html(tdFestival.name);}}}
if(dateTodayStr===date){if($(self.wrap).is(".ui-calendar-mini")){$date.html("今天");}else{$calday.html("今天");}}
var thisDate=Calendar.getDateFromFormattedString(date,self.options.dateFormat);var thisDateMonth=thisDate.getMonth();var thisDateDay=thisDate.getDate();if(self.options.division&&thisDateDay==1){if($(self.wrap).is(".ui-calendar-mini")){}else{$calday.html((thisDateMonth+1)+"月"+thisDateDay+"日");}}})},createHead:function(){return this.options.template.calControl;},createBody:function(){var options=this.options;var html="";var date=this.now;html+=this.createSingleCalendar(date,0);if(options.bimonthly){var nextMonthDate=new Date(date);nextMonthDate.setDate(1);nextMonthDate=Calendar.monthOffset(nextMonthDate,1);html+=this.createSingleCalendar(nextMonthDate,1);}
html=this.replaceWith(options.template.calWrap,{content:html});return html;},createSingleCalendar:function(date,offset){var html="";var options=this.options;var month=date.getMonth();var year=date.getFullYear();var nextMonthDate=Calendar.monthOffset(date,1);var nextMonthYear=nextMonthDate.getFullYear();var nextMonthMonth=nextMonthDate.getMonth();html+=this.replaceWith(options.template.calTitle,{month:this.replaceWith(options.titleTip,{year:year,month:month+1})});if(this.options.division){var nextMonthTitle=this.replaceWith(options.template.calTitle,{month:this.replaceWith(options.titleTip,{year:nextMonthYear,month:nextMonthMonth+1})});nextMonthTitle=nextMonthTitle.replace("caltitle","caltitle caltitlenext");html+=nextMonthTitle}
var weekOffset=this.options.weekOffset;var dayOffset=this.options.dayOffset;var englishWeekTitle=this.options.englishWeekTitle;var weekShortTitle=this.options.weekShortTitle;html+=this.replaceWith(options.template.calBody,{month:month+1,date:this.createDate(date),'englishWeekTitle[0]':englishWeekTitle[(0+weekOffset+dayOffset)%7],'englishWeekTitle[1]':englishWeekTitle[(1+weekOffset+dayOffset)%7],'englishWeekTitle[2]':englishWeekTitle[(2+weekOffset+dayOffset)%7],'englishWeekTitle[3]':englishWeekTitle[(3+weekOffset+dayOffset)%7],'englishWeekTitle[4]':englishWeekTitle[(4+weekOffset+dayOffset)%7],'englishWeekTitle[5]':englishWeekTitle[(5+weekOffset+dayOffset)%7],'englishWeekTitle[6]':englishWeekTitle[(6+weekOffset+dayOffset)%7],'shortWeekTitle[0]':weekShortTitle[(0+weekOffset+dayOffset)%7],'shortWeekTitle[1]':weekShortTitle[(1+weekOffset+dayOffset)%7],'shortWeekTitle[2]':weekShortTitle[(2+weekOffset+dayOffset)%7],'shortWeekTitle[3]':weekShortTitle[(3+weekOffset+dayOffset)%7],'shortWeekTitle[4]':weekShortTitle[(4+weekOffset+dayOffset)%7],'shortWeekTitle[5]':weekShortTitle[(5+weekOffset+dayOffset)%7],'shortWeekTitle[6]':weekShortTitle[(6+weekOffset+dayOffset)%7]});html=this.replaceWith(options.template.calMonth,{content:html,offset:'data-offset="'+offset+'"'});return html;},createDate:function(date){var self=this;var html="";var dateHtml="";var dates=this.getDateArrayByMonth(date);var options=this.options;dates.forEach(function(row){dateHtml="";row.forEach(function(cal){if(cal){var dateMap=Calendar.dateFormat(cal,self.options.dateFormat);var singleDateHtml=self.replaceWith(options.template.day,{week:cal.getDay(),day:Calendar.dateFormat(cal,"dd"),className:self.getClass(cal,date),dateMap:'data-date-map="'+dateMap+'"'});}else{singleDateHtml='<td><div class="date caldate caldisabled"></div></td>';}
dateHtml+=singleDateHtml;});html+=self.replaceWith(options.template.weekWrap,{week:dateHtml});});return html;},getClass:function(cal,date){var year=cal.getFullYear();var month=cal.getMonth();var calDate=Calendar.dateToDay(cal);var className="date";var thisDate=Calendar.dateToDay(this.date);var dayNext=this.options.dayNext;var dayPrev=this.options.dayPrev;var dayDisableNext=this.options.dayDisableNext;var cascadingOffset=this.options.cascadingOffset;var cascadingMin=this.options.cascadingMin;var cascading=this.options.cascading;if((year==date.getFullYear())&&(month==date.getMonth())){className+=" caldate";}else if(this.options.division){className+=" caldate notThisMonth";}else{if(this.wrap.is(".ui-calendar-mini")){className+=" nodate notThisMonth";}else{className+=" caldate notThisMonth";}}
var dayBetween=Calendar.getDaysBetween(thisDate,calDate);if(calDate>thisDate&&dayNext!=-1&&dayBetween>dayNext){className+=" nodate";}
if(calDate>=thisDate&&dayBetween<dayDisableNext){className+=" nodate";}
if(cascading&&this.cascadingIndex===0){var minDate=Calendar.dateOffset(calDate,cascadingMin);var lastDate=Calendar.dateOffset(thisDate,dayNext);if(minDate>lastDate&&dayNext!=-1){className+=" nodate";}}
if((calDate<thisDate)&&(dayPrev!=-1)&&(dayBetween>dayPrev)){className+=" nodate";}
if(Calendar.isSameDay(thisDate,cal)){className+=" today";if(!this.options.isTodayClick){className+=" caldisabled"}}
return className;},replaceWith:function(str,obj){for(var i in obj){str=str.replace("{{"+i+"}}",obj[i]);}
return str;},getDate:function(){return this.now.getDate();},getMonth:function(){return this.now.getMonth();},getFullYear:function(){return this.now.getFullYear();},getDay:function(){return this.now.getDay();},getWeekTitle:function(i){return this.options.weekTitle[i];},getWeekShortTitle:function(i){return this.options.weekShortTitle[i];},getDateArrayByMonth:function(date){var division=this.options.division;var dateArray=[];var year=date.getFullYear();var month=date.getMonth();var firstDate=new Date(year,month,1);var nextMonthFirstDate=new Date(year,month+1,1);var firstDateDay=firstDate.getDay();var index=-firstDateDay+this.options.weekOffset;index=index>0?index-7:index;index+=this.options.dayOffset;var row=0;var col=0;var space;var spaceStart=false;if(division){var lastDayIndex=firstDateDay+Calendar.getDaysInMonth(month,year);if(lastDayIndex>35){index+=22;}else{index+=15;}
if(lastDayIndex==35){space=0}else{space=7;}
for(row=0;row<6;row++){dateArray[row]=[];for(col=0;col<7;col++){var newDate=new Date(firstDate.getFullYear(),firstDate.getMonth(),index);if(space&&(spaceStart||(+nextMonthFirstDate==+newDate))){space--;dateArray[row][col]=null;}else{index++;dateArray[row][col]=newDate;}}}}else{for(row=0;row<6;row++){dateArray[row]=[];for(col=0;col<7;col++){index++;dateArray[row][col]=new Date(firstDate.getFullYear(),firstDate.getMonth(),index);}}}
return dateArray;},getSelect:function(){var cascading=this.options.cascading;if(cascading){return[this.cascadingSelected.start,this.cascadingSelected.end];}else{var selected=[];for(var s in this.selected){selected.push(s)}
return selected;}},getDayOfWeek:function(date,noFestival){date=date||this.now;if(date){if(Calendar.isSameDay(today,date)){return"今天";}
if(!noFestival){var nowStr=Calendar.dateFormat(date,this.options.dateFormat);if(nowStr){var festival=this.options.festival[nowStr];if(festival){if(festival.name){return festival.name;}}}}
var dayOfTheWeek=date.getDay();return this.options.weekTitle[dayOfTheWeek];}},loading:function(){var $loading=this.wrap.find(".month-loading");$loading.show();},loaded:function(){var $loading=this.wrap.find(".month-loading");$loading.hide();}};var calControl='<span class="month-prev" title="上一月">‹</span><span class="month-next" title="下一月">›</span>';var calWrap='<div class="calwrap clearfix">{{content}}</div>';var calMonth='<div class="calmonth" {{offset}}>{{content}}</div>';var calTitle='<div class="caltitle"><span class="mtitle">{{month}}</span></div>';var calTable='<table class="caltable">'+'    <thead>'+'        <tr>'+'            <th class="{{englishWeekTitle[0]}}">{{shortWeekTitle[0]}}</th>'+'            <th class="{{englishWeekTitle[1]}}">{{shortWeekTitle[1]}}</th>'+'            <th class="{{englishWeekTitle[2]}}">{{shortWeekTitle[2]}}</th>'+'            <th class="{{englishWeekTitle[3]}}">{{shortWeekTitle[3]}}</th>'+'            <th class="{{englishWeekTitle[4]}}">{{shortWeekTitle[4]}}</th>'+'            <th class="{{englishWeekTitle[5]}}">{{shortWeekTitle[5]}}</th>'+'            <th class="{{englishWeekTitle[6]}}">{{shortWeekTitle[6]}}</th>'+'        </tr>'+'    </thead>'+'    <tbody>'+'        {{date}}'+'    </tbody>'+'    </table>';var calBody=''+'<div class="calbox">'+
calTable+'    <div class="month-loading"></div>'+'</div>';var weekWrap='<tr>{{week}}</tr>';var smallTemplate={wrap:'<div class="ui-calendar ui-calendar-mini" {{bimonthly}} {{float}}></div>',calControl:calControl,calWrap:calWrap,calMonth:calMonth,calTitle:calTitle,calBody:calBody,weekWrap:weekWrap,day:''+'<td data-week="{{week}}" {{dateMap}}>'+'    <div class="{{className}}">{{day}}</div>'+'</td>'};var bigTemplate={wrap:'<div class="ui-calendar ui-calendar-big" {{bimonthly}} {{float}}></div>',calControl:calControl,calWrap:calWrap,calMonth:calMonth,calTitle:calTitle,calBody:calBody,weekWrap:weekWrap,day:''+'<td data-week="{{week}}" {{dateMap}}>'+'    <div class="{{className}}">'+'        <div class="calday">{{day}}</div>'+'        <div class="calinfo"></div>'+'        <div class="calprice"></div>'+'        <div class="calactive"></div>'+'        <div class="calselected"></div>'+'    </div>'+'</td>'};var birthdayTemplate={wrap:'<div class="ui-calendar ui-calendar-mini ui-calendar-birthday" {{bimonthly}} {{float}}></div>',calControl:calControl,calWrap:calWrap,calMonth:calMonth,calTitle:calTitle,calBody:''+'<div class="calbox">'+
calTable+'<div class="cal-pane">'+'<span class="cal-time-text">时间</span>'+'<span class="cal-time-input">'+'<span class="cal-hour">00</span><span class="cal-time-to">:</span><span class="cal-minute">00</span>'+'</span>'+'<span class="btn btn-xs cal-birthday-clear">清空</span>'+'<span class="btn btn-xs cal-birthday-ok">确定</span>'+'</div>'+'<div class="month-loading"></div>'+'</div>',weekWrap:weekWrap,day:''+'<td data-week="{{week}}" {{dateMap}}>'+'    <div class="{{className}}">{{day}}</div>'+'</td>'};lv.calendar=Factory;window.lv=lv;nova.calendar=Factory;window.nova=nova;for(var c in Calendar){if(typeof Calendar[c]==="function"){Factory[c]=Calendar[c]}}})(window,jQuery,window.lv||{},window.nova||{});
;(function(){function picScroll(tabbox,picBox){var index=0,tabs,pics=picBox.find("li"),l=pics.length,Timer,playing;var j=0;for(j=0;j<l;j++){j==0?tabbox.append('<span class="current"></span>'):tabbox.append("<span></span>");}
tabs=tabbox.find("span");tabs.each(function(e){var me=$(this);me.hover(function(){index=e;showPic(e);});});playing=new autoPlay();$('.banBox-btn').click(function(){var $This=$(this);$This.index()==0?index--:index++;index>l-1&&(index=0);index<0&&(index=l-1);showPic(index);});picBox.parents('.banBox').hover(function(){clearTimeout(Timer);playing=null;},function(){playing=null;clearTimeout(Timer);playing=new autoPlay();});function autoPlay(){var img=new Image();var imgs=pics.eq(index).find('img');var imgSrc=imgs.size()>0?(imgs.attr('to')||imgs.attr('js_to')):null;if(!imgs.attr('src')){if(!imgSrc){clearTimeout(Timer);playing=null;setTimeout(function(){playing=new autoPlay();},1000);return;}else{img.onload=function(){Play();}
img.src=imgSrc;}}else{Play();}
function Play(){showPic(index);Timer=setTimeout(function(){index=index>=(l-1)?0:index+1;playing=new autoPlay();},5000);}};function showPic(i){pics.eq(i).addClass("current").siblings().removeClass("current");tabs.eq(i).addClass("current").siblings().removeClass("current");};}
window.picScroll=picScroll;var tryInitPicScroll=setInterval(function(){var size=$(".banPic").children("li").length;if(size>0){clearInterval(tryInitPicScroll);window.picScroll($('.banTab'),$('.banPic'));}},100);})();(function(){var $body=$('body');var oTomorrow=document.getElementById('tomorrow'),oTayAfterTom=document.getElementById('dayAfterTom'),myDay=new Date(),tomorrow=myDay.getDay()+1,TayAfterTom=tomorrow+1;function weekDay(day){var week;switch(day){case 0||7:week="天";break;case 1:week="一";break;case 2:week="二";break;case 3:week="三";break;case 4:week="四";break;case 5:week="五";break;case 6:week="六";break;default:week="一"}
return week;}
oTomorrow.innerHTML="星期"+weekDay(tomorrow);oTayAfterTom.innerHTML="星期"+weekDay(TayAfterTom);var loadImg=function(){var This=$(this);if(!This.is(':hidden')){var to=This.attr('to');if(to){this.src=This.css({'opacity':0}).attr("to");This.removeAttr("to");if(This.load()){This.animate({'opacity':1},300,function(){This.removeAttr('style')});}
this.onerror=function(){this.src="http://pic.lvmama.com/img/cmt/img_120_60.jpg"}}}};$('.JS_tab>i').click(function(){var $This=$(this),$showBox=$This.parents('.modTit').next('.proList').find('ul').eq($This.index());$This.addClass('current').siblings().removeClass('current');$showBox.show().siblings().hide();$showBox.find('img').each(function(){var $me=$(this),$js_to=$me.attr('to');loadImg.call(this);});});HotelSearchHis();function HotelSearchHis(){var json_cookie,l,$js_mdd=$('#js_mdd'),$startDate=$('#startDate'),$endDate=$('#endDate'),$keyword=$('#js_keyword'),HOTEL_COOKIE='hotelSeachCookie',$hisLi=$('.hisLi');if(!$.xcookie.getCookie(HOTEL_COOKIE)){json_cookie={"hotelSeachCookie":[]};}else{json_cookie=JSON.parse($.xcookie.getCookie(HOTEL_COOKIE));HisSearch();}
$('.hotelSeachbtn').bind('click',function(e){var mdd,startDate,endDate,dataId;mdd=$js_mdd.val();if(mdd=="请输入目的地")return;startDate=$startDate.val();endDate=$endDate.val();dataId=$keyword.attr('data-id');for(x in json_cookie.hotelSeachCookie){if(json_cookie.hotelSeachCookie[x].mdd==mdd){json_cookie.hotelSeachCookie.splice(x,1);}}
json_cookie.hotelSeachCookie.unshift({"mdd":mdd,"startDate":startDate,"endDate":endDate,"dataId":dataId});l>=5&&(json_cookie.hotelSeachCookie.length=5);$.xcookie.setCookie(HOTEL_COOKIE,JSON.stringify(json_cookie),{path:'/',expires:30});});function HisSearch(){var arr,starttimes,d=new Date(),now=d.getTime(),oLi="";l=json_cookie.hotelSeachCookie.length;for(var i=0;i<l;i++){arr=json_cookie.hotelSeachCookie[i].startDate.split("-");starttimes=new Date(arr[0],arr[1],arr[2]);if(starttimes<now){continue;}
oLi+="<li data-id="+json_cookie.hotelSeachCookie[i].dataId+"><a href=\"javascript:;\"><span class=\"his-name\">"+
json_cookie.hotelSeachCookie[i].mdd+"</span><span class=\"his-date\"><i class=\"his-date-startDate\">"+
json_cookie.hotelSeachCookie[i].startDate+"</i>至<i class=\"his-date-endDate\">"+
json_cookie.hotelSeachCookie[i].endDate+"</i></span></a></li>";}
$('.hisLi ul').html(oLi);}
$('.hotelSeach-his').hover(function(){$hisLi.show();},function(){$hisLi.hide();});$hisLi.on('click','li',function(){var $me=$(this);$hisLi.hide();$js_mdd.val($me.find('.his-name').html()).removeClass('des_tip');$startDate.val($me.find('.his-date-startDate').html());$endDate.val($me.find('.his-date-endDate').html());$keyword.attr("data-id",$me.attr("data-id"));});}})(jQuery);$(function(){$('.deals-tab-nav li:last-child').css('marginRight','0px');$('.theme-tab-nav li:first-child').css('marginLeft','0px');tabCon();function tabCon(){$('.js-tab').each(function(){var $this=$(this),$img=$this.find('.holiday-con-left img.holiday-con-left-bg'),$navLi=$this.find('.js-tab-nav li'),$tabCon=$this.find('.js-tab-con');$navLi.eq(0).addClass('active');$tabCon.eq(0).show();$navLi.on('click',function(){var index=$(this).index();$navLi.removeClass('active').eq(index).addClass('active');$tabCon.hide().eq(index).show();showUnloadedImg($tabCon.eq(index));});});$('.js-tab1').each(function(){var $this=$(this),$img=$this.find('.holiday-con-left img.holiday-con-left-bg'),$navLi=$this.find('.js-tab-nav1 li'),$tabCon=$this.find('.js-tab-con1');$img.eq(0).css('display','block');$navLi.eq(0).addClass('active');$tabCon.eq(0).show();$navLi.on('hover',function(){var index=$(this).index();$img.hide().eq(index).css('display','block');$navLi.removeClass('active').eq(index).addClass('active');$tabCon.hide().eq(index).show();showUnloadedImg($tabCon.eq(index));});});}
function showUnloadedImg($showBox){var imgs=$showBox.find('img');imgs.each(function(){var $me=$(this);var imgSrc=$me.attr('to');if(imgSrc){$me.attr('src',imgSrc).removeAttr('to');}});}
(function(){var btn_l=$('.js-scroll-prev'),btn_r=$('.js-scroll-next'),iNumber=0,ulLi=$('.js-scroll-ul').find('li').length,ulwidth=ulLi*145;$('.js-scroll-ul').css('width',(ulwidth+'px'));btn_l.addClass('disabled');if(ulLi<=8)
{btn_r.addClass('disabled');}
btn_r.click(function(){iNumber++;if(ulLi-8>0)
{btn_l.removeClass('disabled');if(iNumber>=ulLi-8){iNumber=ulLi-8;$(this).addClass('disabled');};$(this).siblings('.cooperation-con-ul-hide').find('.js-scroll-ul').stop().animate({left:-145*iNumber});}})
btn_l.click(function(){iNumber--;if(ulLi-8>0)
{btn_r.removeClass('disabled');if(iNumber<=0){iNumber=0;$(this).addClass('disabled');};$(this).siblings('.cooperation-con-ul-hide').find('.js-scroll-ul').stop().animate({left:-145*iNumber});}})})();});
;$(function(){$(document).bind("mousedown",function(){var $actived,viewArr,size,dest,text,keyword,$activedElement=$(".js_destination");$(".hotel_keyword,.hotel_mdd,.des_error_tips,.js_date_msg").hide();if($(".complete-wrap").is(":visible")){if($activedElement.attr("active")){$actived=$(".destinationBox").find("li.active");text=$actived.find("a").attr("data-place");if(/酒店/.test($actived.find('.hotel-place-type').html())){viewArr=text.split(",");size=viewArr.length;dest=viewArr[size-1];keyword=viewArr[0];$activedElement.val(dest);}else if(/行政区/.test($actived.find('.hotel-place-type').html())){$activedElement.val(text);$activedElement.parent().parent().find(".js_keyword").val("");}else{viewArr=text.split(",");size=viewArr.length;dest=viewArr[size-1];keyword=viewArr[0];$activedElement.val(dest);}}}
$(".complete-wrap").hide();});$(".hotel_mdd").bind({"click":function(e){e=e||window.event;if(e.stopPropagation)
e.stopPropagation();else
e.cancelBubble=true;var target=e.target||e.srcElement;switch(target.tagName.toLowerCase()){case"a":var text=$(target).text();$("input:text[active]").val(text).removeClass("des_tip");if($(target).attr("data-id"))
$(".js_keyword:visible").attr("data-id",$(target).attr("data-id"));$(this).hide();break;case"li":var $this=$(target);$this.addClass('active').siblings().removeClass('active');$this.parent().siblings('.mdd_list').find("li:eq("+$this.index()+")").show().siblings().hide();break;case"span":$(this).hide();break;}},"mousedown":function(e){e=e||window.event;if(e.stopPropagation)
e.stopPropagation();else
e.cancelBubble=true;}});$(".hotel_keyword").bind({"click":function(e){e=e||window.event;if(e.stopPropagation)
e.stopPropagation();else
e.cancelBubble=true;var target=e.target||e.srcElement;if(target.tagName.toLowerCase()=="a"){var text=$(target).text();$("input:text[active]").val(text).removeClass("des_tip");$(this).hide();}},"mousedown":function(e){e=e||window.event;if(e.stopPropagation)
e.stopPropagation();else
e.cancelBubble=true;}});(function searchInputInit(){$(".js_destination").bind({"focus":function(){var $this=$(this);$('.tiptextcity').hide();$('.hotel_keyword').hide();$this.removeClass("des_error");if($this.val()=="请输入目的地"){$this.val("").removeClass("des_tip");}
if($.trim($this.val())==''){var thisL=$this.offset().left,thisT=$this.offset().top,thisH=$this.outerHeight(true);$('.hotel_mdd').show().css({'left':thisL,'top':thisT+thisH});};},"blur":function(){var $this=$(this);if($this.val()==""){$this.val("请输入目的地").addClass("des_tip");}
if($this.val()!="请输入目的地"&&!$(".js_keyword").attr("data-id")){$this.addClass("des_error");}},"keyup":function(){var $this=$(this);if($.trim($this.val())==''){var thisL=$this.offset().left,thisT=$this.offset().top,thisH=$this.outerHeight(true);$('.hotel_mdd').show().css({'left':thisL,'top':thisT+thisH});$('.des_error_tips').hide();}else{$('.hotel_mdd').hide();}},"mousedown":function(ev){ev.stopPropagation();$('.ui-calendar').remove();}});$('.js_keyword').bind({"focus":function(){var $this=$(this);if($this.val()=="(选填)酒店名称/商圈/地标"){$this.val("").removeClass("des_tip");}
if($.trim($this.val())==''){hotKeywordInit();};},"blur":function(){var $this=$(this);if($this.val()==""){$this.val("(选填)酒店名称/商圈/地标").addClass("des_tip");}},"keyup":function(){var $this=$(this);var $div=$('.hotel_keyword');if($.trim($this.val())==''){var thisL=$this.offset().left,thisT=$this.offset().top,thisH=$this.outerHeight(true);if($.trim($div.html()).length>0){$div.show().css({'left':thisL,'top':thisT+thisH});}}else{$div.hide();}},"mousedown":function(ev){ev.stopPropagation();$('.ui-calendar').remove();}});}());$('.kind_down_tab li').click(function(){var num=$(this).index();$(this).addClass('active').siblings().removeClass('active');$(this).parent().siblings('.kind_down_list').eq(num).show().siblings('.kind_down_list').hide();});$(".js_destination,.js_keyword").hotelComplete();tipsText();$('#js_keyword,.hotel_keyword').bind('click',function(e){e.stopPropagation();});$(".timeInfo").click(function(e){var event=e||window.event;event.stopPropagation?event.stopPropagation():(event.cancelBubble=true);var $input=$(this).siblings("input.J_calendar");$input.focus();$input.click();})
lv.calendar({autoRender:false,trigger:".J_calendar",triggerEvent:"click",bimonthly:true,template:"small",wrapClass:"ui-calendar-orange",cascading:true,showNumberOfDays:true,cascadingMax:20,monthNext:6,zIndex:21,selectDateCallback:selectDateCallback});function selectDateCallback(cal){$(cal.warp).bind("click",function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();}else e.cancelBubble=true;});var d1=$(cal.options.trigger).eq(0).val().split('-'),d2=$(cal.options.trigger).eq(1).val().split('-'),day=0,nd=null,offset=null,d={};d1=new Date(parseInt(d1[0],10),parseInt(d1[1],10)-1,parseInt(d1[2],10));d2=new Date(parseInt(d2[0],10),parseInt(d2[1],10)-1,parseInt(d2[2],10));d3=$(cal.options.trigger).eq(0).val().split('-'),d4=$(cal.options.trigger).eq(1).val().split('-'),day=(d2.getTime()-d1.getTime())/(1000*3600*24);offset=$(cal.options.trigger).eq(1).offset();if(day>20){$(".J_date_msg").css({position:"absolute",left:offset.left,top:offset.top+cal.$trigger.outerHeight(true)+7}).show();}else{if(day<=0){nd=lv.calendar.dateOffset(d1,1);week=this.getDayOfWeek(nd);if(typeof week==="string"){$(cal.options.trigger).eq(1).siblings(".timeInfo").find("i").html(week);}else{$(cal.options.trigger).eq(1).siblings(".timeInfo").find("i").html(cal.options.weeks[cal._weekIndex+1===7?0:cal._weekIndex+1]);}
$(cal.options.trigger).eq(1).val(lv.calendar.dateFormat(nd,"yyyy-MM-dd"));}
$(".J_date_msg").hide();}
if(cal.$trigger.attr("id")==="startDate"){week=cal.getDayOfWeek(new Date(parseInt(d3[0],10),parseInt(d3[1],10)-1,parseInt(d3[2],10)));}else{week=cal.getDayOfWeek(new Date(parseInt(d4[0],10),parseInt(d4[1],10)-1,parseInt(d4[2],10)));}
if(typeof week==="string"){cal.$trigger.siblings(".timeInfo").find("i").html(week);}else{cal.$trigger.siblings(".timeInfo").find("i").html(cal.options.weeks[cal._weekIndex]);}
if(cal.$trigger[0]===$(cal.options.trigger).eq(0)[0]){var self=cal;setTimeout(function(){$(self.options.trigger).eq(1).click();},0)}}});function searchValidate(){var $des=$(".js_destination:visible");if($.trim($des.val())==""||$.trim($des.val())=="城市/地区/区域"){$des.removeClass("des_tip").addClass("des_error").val("城市/地区/区域");$('.tiptextcity').show();return false;}else if(!$('.J_date_msg').is(':hidden')){return false;}
return true;}
function tipsText(){var html='<div class="tiptext tip-warning tip-info tiptextcity">'
+'<div class="tip-arrow tip-arrow-11">'
+'<em>◆</em>'
+'<i>◆</i>'
+'</div>'
+'<p>请输入您的入住城市名</p>'
+'</div>';$('.hotelSeach-input').eq(0).append(html);}
function hotKeywordInit(){$(".hotel_keyword").html("");var disID=$(".js_keyword").attr("data-id");var dataStr="type=REC&districtId="+disID;if(typeof(disID)=="undefined"){return false;}
$.ajax({url:"http://s.lvmama.com/autocomplete/autoCompleteHotel.do",type:"post",dataType:"jsonp",jsonpCallback:"recive",data:dataStr,success:function(response){dataBind(response);},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("jsonpError:"+errorThrown);}});function dataBind(response){var html=[];if(response.traffic&&response.traffic.length>0){html.push("<dl class=\"keyword_list\"><dt>交通枢纽</dt><dd>");$.each(response.traffic,function(index,item){html.push("<a href=\"javascript:;\">"+item.searchValue+"</a>");});html.push("</dd></dl>");}
if(response.metro&&response.metro.length>0){html.push("<dl class=\"keyword_list\"><dt>地铁站</dt><dd>");$.each(response.metro,function(index,item){html.push("<a href=\"javascript:;\">"+item.searchValue+"</a>");});html.push("</dd></dl>");}
if(response.business&&response.business.length>0){html.push("<dl class=\"keyword_list\"><dt>热门商圈</dt><dd>");$.each(response.business,function(index,item){html.push("<a href=\"javascript:;\">"+item.searchValue+"</a>");});html.push("</dd></dl>");}
if(html.length>0){var $keyword=$(".js_keyword");var thisL=$keyword.offset().left,thisT=$keyword.offset().top,thisH=$keyword.outerHeight(true);$('.hotel_keyword').html(html.join('')).show().css({'left':thisL,'top':thisT+thisH});}}
function recive(response){}}
;(function($){var keys={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};var destinationModel="<li><a href='javascript:;' data-place=\"$searchData\" data-id=\"$searchID\"><span class=\"place-name\">$searchName</span><span class=\"hotel-count\">约$searchCount家酒店</span><span class=\"hotel-place-type\">$searchType</span></a></li>",keywordModel="<li><a href='javascript:;' data-place=\"$searchData\"><span class=\"hotel-name\">$searchName</span><span class=\"hotel-count\">约$searchCount家酒店</span><span class=\"hotel-place-lcat\">$searchType</span></a></li>";var $elements,$activedElement,timeoutId;var querySelecter={completeBox:".complete-wrap",destinationBox:".destinationBox",keywordBox:".keywordBox",errorTipsBox:".des_error_tips",destInput:".js_destination",keywordInput:".js_keyword"};function Factory(){$elements=this;return new searchComplete();}
function timeoutFn(){var fn=new searchComplete("none");fn.requestData();}
function searchComplete(option){if(option)
return;this.initialize();return $elements;}
function autoInputKeyword(value,type,$activedElement,$keyword){if(type==="景区"||type==="酒店"){var viewArr=value.split(",");var size=viewArr.length;var dest=viewArr[size-1];var keyword=viewArr[0];$activedElement.val(dest).removeClass("des_tip");$keyword.val(keyword).removeClass("des_tip");}
if(type==="行政区"){$keyword.val("");}}
searchComplete.prototype={initialize:function(){var that=this;that.createContainer();that.bindEvent();},createContainer:function(){var html=[];html.push("<div class=\"complete-wrap destinationBox\" style=\"display:none\"></div>");html.push("<div class=\"complete-wrap keywordBox\" style=\"display:none\"></div>");html.push("<div class=\"des_error_tips\" style=\"display:none;\"><span>没有找到含“</span><span class=\"word\"></span><span>”的城市</span><span class=\"ico mdd_close\"></span></div>");if($(querySelecter.destinationBox).size()<=0)
$("body").append(html.join(''));},bindEvent:function(){var that=this;that.bindKeyupEvent();that.bindFoucsEvent();that.bindBlurEvent();that.bindMouseEvent();},bindKeyupEvent:function(){var that=this;$elements.bind("keydown",function(e){switch(e.which){case keys.RETURN:e=e||window.event;if(!e.preventDefault())
e.returnValue=false;break;}});$elements.bind("keyup",function(e){switch(e.which){case keys.UP:that.moveUp();break;case keys.DOWN:that.moveDown();break;case keys.ESC:$(querySelecter.completeBox).hide();break;case keys.RETURN:if($(querySelecter.completeBox).is(":visible")){that.select(e);}
break;default:clearTimeout(timeoutId);timeoutId=setTimeout(timeoutFn,300);break;}});},bindFoucsEvent:function(){var that=this;$elements.bind("focus",function(e){var target=e.target||window.event.srcElement;$activedElement=$(target);if($activedElement.is(querySelecter.destInput))
$(querySelecter.keywordBox).hide();else if($activedElement.is(querySelecter.keywordInput))
$(querySelecter.destinationBox).hide();var UlPosition={left:$activedElement.offset().left,top:$activedElement.offset().top+$activedElement.outerHeight()};var UlWidth=$activedElement.outerWidth();var $targetBox=that.getActivedBox();$targetBox.css({left:UlPosition.left,top:UlPosition.top});if($activedElement.val()!=="")
that.requestData();$("input:text[active]").removeAttr("active");$(target).attr("active","actived");});$elements.bind("click",function(e){that.cancelBubble(e);});},bindBlurEvent:function(){},bindMouseEvent:function(){var that=this;$(querySelecter.completeBox).bind("mousedown",function(e){e=e||window.event;var target=e.target||e.srcElement;var $keyword=$(".js_keyword:visible");switch(target.tagName.toLowerCase()){case"a":var $aPlace=$(target);var aValue=$aPlace.attr("data-place");var aType=$aPlace.find(".hotel-place-type").text();$activedElement.val(aValue);$keyword.attr("data-id",$(target).attr("data-id"));autoInputKeyword(aValue,aType,$activedElement,$keyword);break;case"b":var $bPlace=$(target).parent().parent();var bValue=$bPlace.attr("data-place");var bType=$bPlace.find(".hotel-place-type").text();$activedElement.val(bValue);$keyword.attr("data-id",$(target).parent().parent().attr("data-id"));autoInputKeyword(bValue,bType,$activedElement,$keyword);break;case"span":var $spanPlace=$(target).parent();var spanValue=$spanPlace.attr("data-place");var spanType=$spanPlace.find(".hotel-place-type").text();$activedElement.val(spanValue);$keyword.attr("data-id",$(target).parent().attr("data-id"));autoInputKeyword(spanValue,spanType,$activedElement,$keyword);break;case"li":var $liPlace=$(target).find("a");var liValue=$liPlace.attr("data-place");var liType=$liPlace.find(".hotel-place-type").text();$activedElement.val(liValue);$keyword.attr("data-id",$(target).find("a").attr("data-id"));autoInputKeyword(liValue,liType,$activedElement,$keyword);break;}
that.getActivedBox().hide();});$(querySelecter.errorTipsBox).find("i").bind("mousedown",function(){$(this).parent().hide();});},moveDown:function(m){var that=this,$libox,$activeLi,t,$actived,viewArr,size,dest,keyword;if(!that.hasValue()){return;}
$libox=that.getActivedBox();$activeLi=$libox.find("li.active");if(!m){t=$activeLi.size()>0?($activeLi.next().size()>0?$activeLi.removeClass("active").next().addClass("active"):$activeLi.removeClass("active").siblings(":first").addClass("active")):$libox.find("li:first").addClass("active");}else{t=$activeLi.size()>0?($activeLi.prev().size()>0?$activeLi.removeClass("active").prev().addClass("active"):$activeLi.removeClass("active").siblings(":last").addClass("active")):$libox.find("li:last").addClass("active");}
$actived=$libox.find("li.active");if(/酒店/.test($actived.find('.hotel-place-type').html())){viewArr=$actived.find("a").attr("data-place").split(",");size=viewArr.length;dest=viewArr[size-1];keyword=viewArr[0];$activedElement.val(dest);$(".js_keyword:visible").val(keyword).removeClass('des_tip');}else if(/行政区/.test($actived.find('.hotel-place-type').html())){$activedElement.val($actived.find("a").attr("data-place"));$activedElement.parent().parent().find(".js_keyword").val("");}else{viewArr=$actived.find("a").attr("data-place").split(",");size=viewArr.length;dest=viewArr[size-1];keyword=viewArr[0];$activedElement.val(dest);$(".js_keyword:visible").val(keyword).removeClass('des_tip');}},moveUp:function(){this.moveDown.call(this,1);},select:function(e){var $actived=this.getActivedBox().find("li.active");var $activedLink=this.getActivedBox().find("li.active>a");var viewArr,size,dest;if($activedLink.size()>0){if(/酒店/.test($actived.find('.hotel-place-type').html())){viewArr=$actived.find("a").attr("data-place").split(",");size=viewArr.length;dest=viewArr[size-1];$activedElement.val(dest);}else if(/行政区/.test($actived.find('.hotel-place-type').html())){$activedElement.val($actived.find("a").attr("data-place"));$activedElement.parent().parent().find(".js_keyword").val("");}else{$activedElement.val($activedLink.attr("data-place"));viewArr=$actived.find("a").attr("data-place").split(",");size=viewArr.length;dest=viewArr[size-1];keyword=viewArr[0];$activedElement.val(dest);$(".js_keyword:visible").val(keyword).removeClass('des_tip');}}
$(querySelecter.completeBox).hide();},hasValue:function(){if($.trim($activedElement.val())==="")
return false;else
return true;},getActivedBox:function(){return $activedElement.hasClass("js_destination")?$(querySelecter.destinationBox):$(querySelecter.keywordBox);},cancelBubble:function(e){e=e||window.event;if(!e.stopPropagation())
e.cancelBubble=true;},requestData:function(){var that=this;if(!that.hasValue()){that.getActivedBox().hide();return;}
if($activedElement.hasClass("js_destination")){$(".js_keyword").removeAttr("data-id");$(querySelecter.errorTipsBox).hide();}
var keyword=$activedElement.val();var dataStr=$activedElement.hasClass("js_destination")?("type=DEST&keyword="+keyword.split(",")[0]):("type=HOTEL&keyword="+keyword+"&districtId="+$activedElement.attr("data-id"));var ajaxurl="http://s.lvmama.com/autocomplete/autoCompleteHotel.do";$.ajax({url:ajaxurl,type:"post",dataType:"jsonp",jsonpCallback:"recive",data:dataStr,success:function(response){that.dataBind(response);},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("jsonpError:"+errorThrown);}});function recive(response){}},dataBind:function(data){var that=this;if(!(typeof data==="object"))
return;var html="";var k_canton=[],k_scenic=[];if(data.matchList){if(that.getActivedBox().hasClass("destinationBox")){var canton=[],scenic=[],hotel=[];$.each(data.matchList,function(index,items){var finalModel=destinationModel.replace("$searchData",items.trueDistrictAlias);finalModel=finalModel.replace("$searchID",items.districtId);finalModel=finalModel.replace("$searchName",items.districtAlias.replace(new RegExp('('+data.keyword+")","g"),"<b>$&</b>"));if(items.hotelCount==null||items.hotelCount==0){finalModel=finalModel.replace("约$searchCount家酒店","");}else{finalModel=finalModel.replace("$searchCount",items.hotelCount);}
finalModel=finalModel.replace("$searchType",items.type);switch(items.type){case'行政区':canton.push(finalModel);break;case'景区':scenic.push(finalModel);break;default:hotel.push(finalModel);}});if(scenic.length>0&&canton.length>0){scenic[0]=scenic[0].replace("li","li class=\"divide-line\"");}
if(scenic.length>0&&hotel.length>0){hotel[0]=hotel[0].replace("li","li class=\"divide-line\"");}
if(canton.length==0&&scenic.length==0&&hotel.length==0){html="";}else{html="<ul>"+canton.join('')+scenic.join('')+hotel.join('')+"</ul>";}}else{var matchHtml=[],tempKeywordModel="";k_canton=[],k_scenic=[];$.each(data.matchList,function(index,items){tempKeywordModel=keywordModel;if(items.hotelCount==null||items.hotelCount==0){tempKeywordModel=tempKeywordModel.replace("约$searchCount家酒店","");}
if(items.type=="景区"){k_canton.push(tempKeywordModel.replace("$searchData",items.name).replace("$searchCount",items.hotelCount).replace("$searchName",items.name.replace(new RegExp('('+data.keyword+")","g"),"<b>$1</b>")).replace("$searchType",items.type));}else{k_scenic.push(tempKeywordModel.replace("$searchData",items.name).replace("$searchCount",items.hotelCount).replace("$searchName",items.name.replace(new RegExp('('+data.keyword+")","g"),"<b>$1</b>")).replace("$searchType",items.type).replace('产品名称','酒店'));}});if(k_canton.length>0&&k_canton.length>0){k_canton[0]=k_canton[0].replace("li","li class=\"divide-line\"");}
if(k_canton.length==0&&k_scenic.length==0)
html="";else
html="<ul>"+k_scenic.join('')+k_canton.join('')+"</ul>";}}
if(html===""){that.getActivedBox().hide();if($activedElement.hasClass("js_destination")){var thisL=$activedElement.offset().left,thisT=$activedElement.offset().top,thisH=$activedElement.outerHeight(true);$(querySelecter.errorTipsBox).show().css({'left':thisL,'top':thisT+thisH}).find(".word").text($activedElement.val());}
return;}
that.getActivedBox().show().html(html);if($activedElement.hasClass("js_destination")){var $a=that.getActivedBox().find("li:first").addClass("active").find("a");$(".js_keyword:visible").attr("data-id",$a.attr("data-id"));}}};$.fn.hotelComplete=$.hotelComplete=Factory;}(jQuery));